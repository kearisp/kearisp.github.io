"use strict";(self.webpackChunkkearisp=self.webpackChunkkearisp||[]).push([[554],{4554:(t,e,n)=>{n.r(e),n.d(e,{default:()=>$});var o=n(5043),r=n(1032),i=n(6446),s=function(){function t(){this.width=0,this.height=0,this.fov=45,this.models=[],this.debug=!1}return t.prototype.setDebug=function(t){this.debug=t},t.prototype.getWidth=function(){return this.width},t.prototype.getHeight=function(){return this.height},t.prototype.setSizes=function(t,e){this.setWidth(t),this.setHeight(e)},t.prototype.setWidth=function(t){this.width=t},t.prototype.setHeight=function(t){this.height=t},t.prototype.getFov=function(){return this.fov},t.prototype.setFov=function(t){this.fov=t},t.prototype.addModel=function(t){this.models.push(t)},t.prototype.removeModel=function(t){this.models=this.models.filter((function(e){return e!==t}))},t}(),a=function(){function t(t,e,n){this.x=t,this.y=e,this.z=n}return Object.defineProperty(t.prototype,"distance",{get:function(){return t.distance(this)},enumerable:!1,configurable:!0}),t.prototype.set=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},t.prototype.add=function(e){return this.set(t.summary(this,e)),this},t.prototype.multiply=function(e){return this.set(t.multiply(this,e)),this},t.prototype.sub=function(e){return this.set(t.subtract(this,e)),this},t.prototype.normalize=function(){var e=t.normalize(this),n=e.x,o=e.y,r=e.z;return this.x=n,this.y=o,this.z=r,this},t.prototype.toPoint=function(){return{x:this.x,y:this.y,z:this.z}},t.fromPoint=function(e){return new t(e.x,e.y,e.z)},t.summary=function(t,e){return{x:t.x+e.x,y:t.y+e.y,z:t.z+e.z}},t.subtract=function(t,e){return{x:t.x-e.x,y:t.y-e.y,z:t.z-e.z}},t.cross=function(t,e){return{x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}},t.distance=function(t){return Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)+Math.pow(t.z,2))},t.distanceBetween=function(e,n){var o=t.subtract(n,e);return t.distance(o)},t.normalize=function(t){var e=Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)+Math.pow(t.z,2));return{x:t.x/e,y:t.y/e,z:t.z/e}},t.magnitude=function(e){return Math.sqrt(t.dot(e,e))},t.angle=function(e,n){var o=t.magnitude(e),r=t.magnitude(n),i=t.dot(e,n);return Math.acos(i/(o*r))},t.multiply=function(t,e){return{x:t.x*e,y:t.y*e,z:t.z*e}},t.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},t.intersectPlane=function(e,n,o,r,i){return t.intersectPlaneV2(e,n,o,r,i)},t.intersectPlaneV1=function(e,n,o,r,i){var s=t.subtract(r,o),a=t.subtract(i,o),c=t.cross(s,a),u=t.dot(c,n);if(Math.abs(u)<1e-7)return null;var h=t.dot(c,t.subtract(o,e))/u;return h<0?null:t.summary(e,t.multiply(n,h))},t.intersectPlaneV2=function(e,n,o,r,i){var s=t.subtract(r,o),a=t.subtract(i,o),c=t.cross(s,a),u=-t.dot(c,o),h=t.dot(c,n);if(Math.abs(h)<1e-6)return null;var l=-(t.dot(c,e)+u)/h;return t.summary(e,t.multiply(n,l))},t.intersectPolygon=function(e,n,o){var r=-t.dot(o.getNormal(),o.points[0]),i=-(t.dot(o.getNormal(),e)+r)/t.dot(o.getNormal(),n);if(isNaN(i)||!isFinite(i))return null;var s=t.summary(t.multiply(n,i),e);!isNaN(s.x)&&isFinite(s.x)||console.log(e,i,s);for(var a=0;a<o.points.length;a++){var c=o.points[a],u=o.points[(a+1)%o.points.length],h=t.subtract(u,c),l=t.subtract(s,c),p=t.cross(h,l);if(t.dot(o.getNormal(),p)<=1)return null}return s},t.getAngle=function(e,n){var o=t.dot(e,n)/(t.distance(e)*t.distance(n));return Math.acos(o)*(180/Math.PI)},t.areCoDirected=function(e,n){return t.areCoDirectedV2(e,n)},t.areCoDirectedV1=function(t,e){var n=t.x/e.x,o=t.y/e.y,r=t.z/e.z;if(isNaN(n)||isNaN(o)||isNaN(r))return!1;var i=Math.pow(10,-14);return!(Math.abs(n-o)>i||Math.abs(n-r)>i||Math.abs(o-r)>i)},t.areCoDirectedV2=function(e,n){return t.dot(e,n)/(t.distance(e)*t.distance(n))<=Math.cos(Math.PI/180*90)},t}(),c=function(){function t(t){this.points=t}return t.prototype.getCenter=function(){return this.center||this.calcCenter(),this.center},t.prototype.calcCenter=function(){for(var t={x:0,y:0},e=0;e<this.points.length;e++)t.x+=this.points[e].x,t.y+=this.points[e].y;this.center={x:t.x/this.points.length,y:t.y/this.points.length}},t}(),u=function(t,e,n){if(n||2===arguments.length)for(var o,r=0,i=e.length;r<i;r++)!o&&r in e||(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))},h=function(){function t(t,e){this.points=t,this.normal=e||this.calcNormal(),this.center=this.calcCenter()}return t.prototype.setId=function(t){this.id=t},t.prototype.intersects=function(e){for(var n=0,o=u(u([],t.getNormals(this.points),!0),t.getNormals(e.points),!0);n<o.length;n++){var r=o[n],i=t.projection(this.points,r),s=t.projection(e.points,r);if(i.max<s.min||s.max<i.min)return!1;if(i.max===s.min||s.max===i.min)return!1}return!0},t.prototype.smooth=function(){return[]},t.prototype.getNormal=function(){return this.normal},t.prototype.calcNormal=function(){for(var t={x:0,y:0,z:0},e=0;e<this.points.length;e++){var n=this.points[e],o=this.points[(e+1)%this.points.length],r=this.points[(e+2)%this.points.length],i=a.subtract(n,o),s=a.subtract(n,r),c=a.cross(i,s);t=a.summary(t,c)}return a.normalize({x:t.x/this.points.length,y:t.y/this.points.length,z:t.z/this.points.length})},t.prototype.getCenter=function(){return this.center},t.prototype.calcCenter=function(){for(var t={x:0,y:0,z:0},e=0;e<this.points.length;e++)t=a.summary(this.points[e],t);return{x:t.x/this.points.length,y:t.y/this.points.length,z:t.z/this.points.length}},t.prototype.getVector1=function(){return a.normalize(a.cross(this.getNormal(),{x:0,y:0,z:-1}))},t.prototype.getVector2=function(){return a.normalize(a.cross(this.getNormal(),{x:1,y:0,z:0}))},t.prototype.isOnSamePlane=function(t){var e=this.points[0];if(!e)return!1;var n=this.getNormal(),o=a.dot(a.subtract(t,e),n);return Math.abs(o)<1e-4},t.prototype.isContainPoint=function(t){return this.isContainPointV2(t)},t.prototype.isContainPointV1=function(t){for(var e=!1,n=0;n<this.points.length;n++){var o=this.points[n],r=this.points[(n+1)%this.points.length],i=this.points[(n+2)%this.points.length],s=a.subtract(i,o),c=a.subtract(r,o),u=a.subtract(t,o),h=a.dot(s,s),l=a.dot(s,c),p=a.dot(s,u),f=a.dot(c,c),y=a.dot(c,u),g=1/(h*f-l*l),x=(f*p-l*y)*g,d=(h*y-l*p)*g;if(x>=0&&d>=0&&x+d<1){e=!0;break}}return e},t.prototype.isContainPointV2=function(t){for(var e=0,n=0;n<this.points.length;n++){var o=this.points[n],r=this.points[(n+1)%this.points.length],i=a.subtract(r,o),s=a.dot(i,a.subtract(t,o))/a.dot(i,i),c=1e-6;s>c&&s<.999999&&(e+=a.angle(a.subtract(r,t),a.subtract(o,t)))}return Math.abs(e-2*Math.PI)<=.01},t.prototype.isContainPointV3=function(t){for(var e=0;e<this.points.length;e++){var n=this.points[e],o=this.points[(e+1)%this.points.length],r=a.subtract(o,n),i=a.subtract(t,n),s=a.cross(r,i);if(a.dot(this.getNormal(),s)<=-1)return!1}return!0},t.prototype.project=function(t){var e=this.points.map((function(e){return t?t.projectPoint(e):{x:e.x,y:e.y}})).filter((function(t){return!isNaN(t.x)&&!isNaN(t.y)}));return new c(e)},t.prototype.project2=function(){var t=this;var e=this.points.map((function(e){return function(t,e){var n,o,r=function(t,e){return{x:t.x*e,y:t.y*e,z:t.z*e}}(e,function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}(e,t));return o=r,{x:(n=t).x-o.x,y:n.y-o.y,z:n.z-o.z}}(e,a.subtract(t.points[0],t.points[1]))}));return new c(e)},t.isIntersect=function(t,e){return!1},t.intersect=function(e,n){for(var o=[],r=[],i=!0,s=0;s<e.points.length;s++){var c=e.points[s],u=e.points[(s+1)%e.points.length],h=a.subtract(u,c);i?o.push(c):r.push(c);for(var l=0;l<n.points.length;l++){var p=n.points[l],f=n.points[(l+1)%n.points.length],y=n.points[(l+2)%n.points.length],g=a.intersectPlane(c,h,p,f,y);if(!(g&&a.distance(a.subtract(c,g))<0)&&(g&&e.isContainPoint(g))){o.push(g),r.push(g),i=!i;break}}}if(0===r.length)return[e];var x=new t(o);x.setId("".concat(e.id,".before")),x.color=e.color;var d=new t(r);return d.setId("".concat(e.id,".after")),d.color=e.color,[x,d]},t.getNormals=function(t){for(var e=[],n=0;n<t.length;n++){var o=t[n],r=t[(n+1)%t.length],i={x:r.x-o.x,y:r.y-o.y,z:r.z-o.z},s={x:-i.y,y:i.x,z:i.z};e.push(s)}return e},t.projection=function(t,e){for(var n=e.x*t[0].x+e.y*t[0].y,o=n,r=1;r<t.length;r++){var i=e.x*t[r].x+e.y*t[r].y;i<n?n=i:i>o&&(o=i)}return{min:n,max:o}},t.prototype.triangulate=function(t){return void 0===t&&(t=!1),this.triangulateV1(t)},t.prototype.triangulateV1=function(e){void 0===e&&(e=!1);for(var n=[],o=this.points.slice();o.length>3;){for(var r=!1,i=0;i<o.length&&3!==o.length;i++){var s=o[i],a=o[(i+1)%o.length],c=o[(i+2)%o.length],u={x:(s.x+c.x)/2,y:(s.y+c.y)/2,z:(s.z+c.z)/2};if(this.isContainPoint(u)){var h=new t([s,a,c]);h.color=this.color,n.push(h),o.splice((i+1)%o.length,1),r=!0}}if(!r)break}var l=new t(o);return l.color=this.color,n.push(l),n},t}(),l=function(t,e,n){if(n||2===arguments.length)for(var o,r=0,i=e.length;r<i;r++)!o&&r in e||(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))},p=function(){function t(e,n,o){void 0===o&&(o=!1),this.debug=!1,this.camera=n;var r=[],i=[],s=e.sort((function(t,e){return a.distance(t.getCenter())-a.distance(e.getCenter())})),c=s[0],u=s.slice(1);this.root=c,this.debug=o;for(var l=0,p=u;l<p.length;l++)for(var f=p[l],y=0,g=h.intersect(f,c);y<g.length;y++){var x=g[y],d=this.classifyPolygon(x);switch(d){case"front":r.push(x);break;case"back":i.push(x);break;case"coplanar":this.debug&&console.log(d,this.root,x)}}this.front=r.length>0?new t(r,n,this.debug):null,this.back=i.length>0?new t(i,n,this.debug):null}return t.prototype.classifyPolygon=function(t){return this.isInFront(t)?"front":"back"},t.prototype.isInFront=function(t){return this.isInFrontV1(t)},t.prototype.isInFrontV1=function(t){var e=a.subtract(this.root.getCenter(),t.getCenter());return a.dot(this.root.getNormal(),e)<0},t.prototype.isInFrontV2=function(t){var e=a.subtract(this.root.getCenter(),{x:0,y:0,z:-1}),n=this.root.getNormal();return a.dot(n,e)/(a.magnitude(n)*a.magnitude(e))>0},t.prototype.traverse=function(t,e){this.root&&this.traverseV1(t,e)},t.prototype.traverseV1=function(t,e){a.dot(this.root.getNormal(),t)<0?(this.front&&this.front.traverseV1(t,e),e(this.root),this.back&&this.back.traverseV1(t,e)):(this.back&&this.back.traverseV1(t,e),e(this.root),this.front&&this.front.traverseV1(t,e))},t.prototype.traverseV2=function(t,e){var n=a.dot(this.root.getNormal(),t)<0,o=this.root.getVector1(),r=this.root.getVector2(),i=a.multiply(o,100),s=a.multiply(o,-100),c=a.summary(this.root.getCenter(),a.multiply(r,-100)),u=a.summary(this.root.getCenter(),a.multiply(r,100)),h=(this.camera.projectPoint(i),this.camera.projectPoint(s),this.camera.projectPoint(c)),p=this.camera.projectPoint(u),f=["\n","p3=",{x:c.x,y:c.y},"\n","p4=",{x:u.x,y:u.y},"\n","d3=",h,"\n","d4=",p];Math.abs(c.x-u.x)<.3&&c.y>u.y&&h.y<p.y&&(this.debug&&console.log.apply(console,l([this.root.id,"y changed 1"],f,!1)),n=!n),n?(this.front&&this.front.traverseV2(t,e),e(this.root),this.back&&this.back.traverseV2(t,e)):(this.back&&this.back.traverseV2(t,e),e(this.root),this.front&&this.front.traverseV2(t,e))},t}(),f=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),y=function(t){function e(){var e=t.call(this)||this;return e.canvas=document.createElement("canvas"),e.context=e.canvas.getContext("2d"),e}return f(e,t),Object.defineProperty(e.prototype,"domElement",{get:function(){return this.canvas},enumerable:!1,configurable:!0}),e.prototype.setWidth=function(e){t.prototype.setWidth.call(this,e),this.canvas.width=e},e.prototype.setHeight=function(e){t.prototype.setHeight.call(this,e),this.canvas.height=e},e.prototype.projectPoint=function(t){return{x:NaN,y:NaN}},e.prototype.setStrokeStyle=function(t){this.context.strokeStyle=t},e.prototype.setFillStyle=function(t){this.context.fillStyle=t},e.prototype.drawLine=function(t,e){this.context.lineWidth=.5,this.context.beginPath(),this.context.moveTo(this.getWidth()/2+t.x,this.getHeight()/2-t.y),this.context.lineTo(this.getWidth()/2+e.x,this.getHeight()/2-e.y),this.context.stroke(),this.context.closePath()},e.prototype.drawPolygon=function(t){},e.prototype.fillRect=function(t,e,n,o){this.context.fillRect(t,e,n,o)},e.prototype.fillPolygon=function(t){this.context.beginPath();var e=t[0],n=t.slice(1);if(e){this.context.moveTo((e.x+1)*this.getWidth()/2,(1-e.y)*this.getHeight()/2);for(var o=0;o<n.length;o++)this.context.lineTo((n[o].x+1)*this.getWidth()/2,(1-n[o].y)*this.getHeight()/2);this.context.closePath(),this.context.stroke(),this.context.fill()}},e.prototype.clear=function(){this.context.clearRect(0,0,this.getWidth(),this.getHeight())},e.prototype.render=function(t,e){},e.prototype.renderPolygons=function(t,e){var n=this,o=new p(t,e,!1),r=new h([{x:-100,y:-100,z:-1e3},{x:100,y:-100,z:-1e3},{x:-100,y:-100,z:-1e3},{x:100,y:100,z:-1e3}]);o.traverse({x:0,y:0,z:1},(function(t){n.setStrokeStyle("#445555"),n.setFillStyle(t.color||"#990000"),h.intersect(t,r).forEach((function(t){n.fillPolygon(t.project(e).points)}))}))},e}(s),g=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),x=function(t){function e(){var e=t.call(this)||this;return e.strokeStyle="#FFFFFF",e.fillStyle="#FFFFFF",e.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),e.svg.setAttribute("width","100%"),e.svg.setAttribute("height","100%"),e}return g(e,t),Object.defineProperty(e.prototype,"domElement",{get:function(){return this.svg},enumerable:!1,configurable:!0}),e.prototype.createSVGElement=function(t){return document.createElementNS("http://www.w3.org/2000/svg",t)},e.prototype.setStrokeStyle=function(t){this.strokeStyle=t},e.prototype.setFillStyle=function(t){this.fillStyle=t},e.prototype.drawLine=function(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1","".concat(t.x)),n.setAttribute("y1","".concat(t.y)),n.setAttribute("x2","".concat(e.x)),n.setAttribute("y2","".concat(e.y)),n.setAttribute("stroke",this.strokeStyle),n.setAttribute("stroke-width","1"),this.svg.appendChild(n)},e.prototype.fillRect=function(t,e,n,o){var r=document.createElementNS("http://www.w3.org/2000/svg","rect");r.setAttribute("x","".concat(t)),r.setAttribute("y","".concat(e)),r.setAttribute("width","".concat(n)),r.setAttribute("height","".concat(o)),r.setAttribute("fill",this.fillStyle),this.svg.appendChild(r)},e.prototype.fillPolygon=function(t){var e=this,n=document.createElementNS("http://www.w3.org/2000/svg","polygon");n.setAttribute("style","fill: ".concat(this.fillStyle)),n.setAttribute("points",t.map((function(t){return"".concat((t.x+1)*e.width/2,",").concat((1-t.y)*e.getHeight()/2)})).join(" ")),n.setAttribute("stroke-width","0.9"),n.setAttribute("stroke","black"),this.svg.append(n)},e.prototype.clear=function(){for(;this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild)},e.prototype.render=function(t,e){},e.prototype.renderPolygons=function(t,e){var n=this;new p(t,e,!1).traverse({x:0,y:0,z:1},(function(t){n.setStrokeStyle("#445555"),n.setFillStyle(t.color||"#990000"),n.fillPolygon(t.project(e).points)}))},e}(s),d=n(4310),v=function(){function t(){this.listeners={}}return t.prototype.addEventListener=function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},t.prototype.removeEventListener=function(t,e){if(this.listeners[t]){var n=this.listeners[t].indexOf(e);-1!==n&&this.listeners[t].splice(n,1)}},t.prototype.emit=function(t,e){this.listeners[t]&&this.listeners[t].forEach((function(t){return t(e)}))},t}(),m=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),b=function(t){function e(e,n,o){void 0===n&&(n={x:0,y:0,z:0}),void 0===o&&(o={x:0,y:0,z:1});var r=t.call(this)||this;return r.context=e,r.isDebug=!1,r.fov=45,r.pitch=0,r.yaw=0,r.roll=0,r.position=a.fromPoint(n),r.direction=a.fromPoint(o),r.rotationMatrix=r.calcDirectionMatrix(),r}return m(e,t),e.prototype.getPosition=function(){return this.position},e.prototype.setPosition=function(t){this.position.set(t),this.rotationMatrix=this.calcDirectionMatrix(),this.emit("positionChange",{position:this.position})},e.prototype.calcDirectionMatrix=function(){return function(t,e,n){void 0===n&&(n={x:0,y:1,z:0});var o=a.normalize(a.cross(n,e)),r=a.normalize(a.cross(e,o));return[[o.x,r.x,e.x,t.x],[o.y,r.y,e.y,t.y],[o.z,r.z,e.z,t.z],[0,0,0,1]]}(this.position,this.direction)},e.prototype.getProjectionMatrix=function(){var t=this.fov*Math.PI/180,e=this.context.getWidth()/this.context.getHeight(),n=d.vt();d.fN(n,t,e,.1,1500);for(var o=[],r=0;r<4;r++)o[r]=[n[4*r],n[4*r+1],n[4*r+2],n[4*r+3]];return o},e.prototype.transformPointToCameraView=function(t){var e=this.rotationMatrix;return{x:(t.x*e[0][0]+t.y*e[1][0]+t.z*e[2][0]+e[3][0])/1,y:(t.x*e[0][1]+t.y*e[1][1]+t.z*e[2][1]+e[3][1])/1,z:(t.x*e[0][2]+t.y*e[1][2]+t.z*e[2][2]+e[3][2])/1}},e.prototype.projectPoint=function(t){var e=this.projectPointV2(t);return Math.abs(e.x)>1||Math.abs(e.y)>1||Math.abs(e.z)>1?{x:NaN,y:NaN,z:NaN}:e},e.prototype.projectPointV1=function(t){var e=t.x,n=t.y,o=t.z;if(o/3<=-this.fov)return{x:NaN,y:NaN};var r=this.fov/(this.fov+o/3);return{x:r*e,y:r*n}},e.prototype.projectPointV2=function(t){var e=this.getProjectionMatrix(),n=t.x*e[0][0]+t.y*e[1][0]+t.z*e[2][0]+e[3][0],o=t.x*e[0][1]+t.y*e[1][1]+t.z*e[2][1]+e[3][1],r=t.x*e[0][2]+t.y*e[1][2]+t.z*e[2][2]+e[3][2],i=t.x*e[0][3]+t.y*e[1][3]+t.z*e[2][3]+e[3][3];return{x:n/i,y:o/i,z:r/i}},e.prototype.getFov=function(){return this.fov},e.prototype.setFov=function(t){this.fov=t,this.emit("fovChange",{fov:this.fov})},e.prototype.setDebug=function(t){this.isDebug=t},e.prototype.getDirection=function(){return this.direction},e.prototype.getDirectionLeft=function(){return a.cross(this.direction,{x:0,y:1,z:0})},e.prototype.setDirection=function(t){this.direction.set(t),this.rotationMatrix=this.calcDirectionMatrix(),this.emit("directionChange",{direction:this.direction,pitch:this.pitch,yaw:this.yaw})},e.prototype.setDirectionFromAngles=function(t,e){this.pitch=Math.max(Math.min(t,90),-90),this.yaw=e;var n=this.pitch*(Math.PI/180),o=this.yaw*(Math.PI/180);this.setDirection({x:Math.cos(n)*Math.sin(o),y:Math.sin(n),z:Math.cos(n)*Math.cos(o)})},e.prototype.getPitch=function(){return this.pitch},e.prototype.setPitch=function(t){this.setDirectionFromAngles(t,this.yaw)},e.prototype.getYaw=function(){return this.yaw},e.prototype.setYaw=function(t){this.setDirectionFromAngles(this.pitch,t)},e.prototype.getRoll=function(){return this.roll},e.prototype.setRoll=function(t){this.roll=t},e}(v),w=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),P=function(t){function e(e){var n=t.call(this)||this;return n.scale=1,n.rotation=0,n.rotationDirection={x:0,y:1,z:0},n.points=[],n.polygons=[],n.position=e||{x:0,y:0,z:0},n.rotationMatrix=n.calcDirectionMatrix(),n}return w(e,t),e.prototype.getId=function(){return this.id},e.prototype.setId=function(t){this.id=t},e.prototype.getPosition=function(){return this.position},e.prototype.setPosition=function(t){this.position=t},e.prototype.getPoints=function(){var t=this;return this.points.map((function(e){return t.getRotatedPoint(e)}))},e.prototype.getPolygons=function(){return this.polygons},e.prototype.getPolygonsV2=function(){var t=this;return this.polygons.map((function(e){var n=e.map((function(e){return t.points[e]}));return new h(n)})).flat()},e.prototype.getPolygonsV3=function(){var t=this;return this.polygons.map((function(e){var n=e.map((function(e){return t.points[e]}));return new h(n).triangulate()})).flat()},e.prototype.getMaterial=function(){return this.material},e.prototype.setMaterial=function(t){this.material=t},e.prototype.getScale=function(){return this.scale},e.prototype.setScale=function(t){this.scale=Math.min(Math.max(t,1),0)},e.prototype.setDirection=function(t){this.rotationDirection=a.normalize(t),this.rotationMatrix=this.calcDirectionMatrix()},e.prototype.rotate=function(t,e){this.rotation=t,e&&(this.rotationDirection=a.normalize(e)),this.rotationMatrix=this.calcDirectionMatrix()},e.prototype.calcDirectionMatrix=function(){return function(t,e){var n=e*(Math.PI/180),o=Math.cos(n),r=Math.sin(n);return[[o+Math.pow(t.x,2)*(1-o),t.x*t.y*(1-o)-t.z*r,t.x*t.z*(1-o)+t.y*r],[t.y*t.x*(1-o)+t.z*r,o+Math.pow(t.y,2)*(1-o),t.y*t.z*(1-o)-t.x*r],[t.z*t.x*(1-o)-t.y*r,t.z*t.y*(1-o)+t.x*r,o+Math.pow(t.z,2)*(1-o)]]}(this.rotationDirection,this.rotation)},e.prototype.getRotatedPoint=function(t){return{x:t.x*this.rotationMatrix[0][0]+t.y*this.rotationMatrix[0][1]+t.z*this.rotationMatrix[0][2],y:t.x*this.rotationMatrix[1][0]+t.y*this.rotationMatrix[1][1]+t.z*this.rotationMatrix[1][2],z:t.x*this.rotationMatrix[2][0]+t.y*this.rotationMatrix[2][1]+t.z*this.rotationMatrix[2][2]}},e}(v),z=function(){function t(){}return t.parse=function(e){return t.parseRgb(e)||t.parseHsl(e)||t.parseHsla(e)||[1,1,1,1]},t.parseRgb=function(t){return"#"!==t[0]?null:[parseInt(t.slice(1,3),16)/255,parseInt(t.slice(3,5),16)/255,parseInt(t.slice(5,7),16)/255,1]},t.parseHsl=function(t){var e=t.match(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/);if(!e)return null;var n=parseInt(e[1])/60,o=parseInt(e[2])/100,r=parseInt(e[3])/100,i=(1-Math.abs(2*r-1))*o,s=i*(1-Math.abs(n%2-1)),a=r-i/2,c=0,u=0,h=0;return 0<=n&&n<1?(c=i,u=s,h=0):1<=n&&n<2?(c=s,u=i,h=0):2<=n&&n<3?(c=0,u=i,h=s):3<=n&&n<4?(c=0,u=s,h=i):4<=n&&n<5?(c=s,u=0,h=i):5<=n&&n<6&&(c=i,u=0,h=s),[c+a,u+a,h+a,1]},t.parseHsla=function(t){var e=t.match(/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/);if(!e)return null;var n=parseInt(e[1])/60,o=parseInt(e[2])/100,r=parseInt(e[3])/100,i=parseFloat(e[4]),s=(1-Math.abs(2*r-1))*o,a=s*(1-Math.abs(n%2-1)),c=r-s/2,u=0,h=0,l=0;return 0<=n&&n<1?(u=s,h=a,l=0):1<=n&&n<2?(u=a,h=s,l=0):2<=n&&n<3?(u=0,h=s,l=a):3<=n&&n<4?(u=0,h=a,l=s):4<=n&&n<5?(u=a,h=0,l=s):5<=n&&n<6&&(u=s,h=0,l=a),[u+c,h+c,l+c,i]},t}(),A=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),C=function(t){function e(){var e=t.call(this)||this;e.canvas=document.createElement("canvas");var n=e.canvas.getContext("webgl");if(!n)throw new Error;return e.context=n,e.program=e.initShaderProgram(),e}return A(e,t),Object.defineProperty(e.prototype,"domElement",{get:function(){return this.canvas},enumerable:!1,configurable:!0}),e.prototype.initShaderProgram=function(){var t=this.loadShader(this.context.VERTEX_SHADER,"\n            attribute vec4 aVertexPosition;\n            attribute vec4 aVertexColor;\n\n            uniform mat4 uModelViewMatrix;\n            uniform mat4 uProjectionMatrix;\n\n            varying lowp vec4 vColor;\n\n            void main(void) {\n                gl_Position = uProjectionMatrix * uModelViewMatrix * aVertexPosition;\n                vColor = aVertexColor;\n            }\n        "),e=this.loadShader(this.context.FRAGMENT_SHADER,"\n            varying lowp vec4 vColor;\n\n            void main(void) {\n                gl_FragColor = vColor;\n            }\n        "),n=this.context.createProgram();if(!n)throw new Error("Failed to create program");if(this.context.attachShader(n,t),this.context.attachShader(n,e),this.context.linkProgram(n),!this.context.getProgramParameter(n,this.context.LINK_STATUS))throw new Error("Failed to link program: "+this.context.getProgramInfoLog(n));return n},e.prototype.loadShader=function(t,e){var n=this.context.createShader(t);if(!n)throw new Error("Failed to create shader");if(this.context.shaderSource(n,e),this.context.compileShader(n),!this.context.getShaderParameter(n,this.context.COMPILE_STATUS))throw new Error("Failed to compile shader: "+this.context.getShaderInfoLog(n));return n},e.prototype.setWidth=function(e){t.prototype.setWidth.call(this,e),this.canvas.width=e},e.prototype.setHeight=function(e){t.prototype.setHeight.call(this,e),this.canvas.height=e},e.prototype.clear=function(){this.context.clearColor(0,0,0,1),this.context.clearDepth(1),this.context.enable(this.context.DEPTH_TEST),this.context.depthFunc(this.context.LEQUAL),this.context.clear(this.context.COLOR_BUFFER_BIT|this.context.DEPTH_BUFFER_BIT)},e.prototype.getModelViewMatrix=function(t){var e=d.vt();return d.Tl(e,e,[-0,0,-6]),d.e$(e,e,t,[0,0,1]),d.e$(e,e,.7*t,[0,1,0]),d.e$(e,e,.3*t,[1,0,0]),e},e.prototype.render=function(t,e){},e.prototype.renderPolygons=function(t,e){for(var n=this,o=0,r=t;o<r.length;o++){r[o].triangulate(this.debug).forEach((function(t){n.drawPolygon(t,e)}))}},e.prototype.drawPolygon=function(t,e){var n=this.context.createBuffer(),o=t.points.map((function(t){return[t.x,t.y,t.z]})).flat();this.context.bindBuffer(this.context.ARRAY_BUFFER,n),this.context.bufferData(this.context.ARRAY_BUFFER,new Float32Array(o),this.context.STATIC_DRAW);var r=z.parse(t.color||"");this.debug&&console.log(t.color,r);var i=t.points.map((function(){return r})).flat(),s=this.context.createBuffer();this.context.bindBuffer(this.context.ARRAY_BUFFER,s),this.context.bufferData(this.context.ARRAY_BUFFER,new Float32Array(i),this.context.STATIC_DRAW);var a=this.context.createBuffer(),c=Array.from({length:t.points.length}).map((function(t,e){return e}));this.context.bindBuffer(this.context.ELEMENT_ARRAY_BUFFER,a),this.context.bufferData(this.context.ELEMENT_ARRAY_BUFFER,new Uint16Array(c),this.context.STATIC_DRAW),this.context.bindBuffer(this.context.ARRAY_BUFFER,n),this.context.vertexAttribPointer(this.context.getAttribLocation(this.program,"aVertexPosition"),3,this.context.FLOAT,!1,0,0),this.context.enableVertexAttribArray(this.context.getAttribLocation(this.program,"aVertexPosition")),this.context.bindBuffer(this.context.ARRAY_BUFFER,s),this.context.vertexAttribPointer(this.context.getAttribLocation(this.program,"aVertexColor"),4,this.context.FLOAT,!1,0,0),this.context.enableVertexAttribArray(this.context.getAttribLocation(this.program,"aVertexColor")),this.context.bindBuffer(this.context.ELEMENT_ARRAY_BUFFER,a),this.context.useProgram(this.program),this.context.uniformMatrix4fv(this.context.getUniformLocation(this.program,"uProjectionMatrix"),!1,new Float32Array(e.getProjectionMatrix().flat())),this.context.uniformMatrix4fv(this.context.getUniformLocation(this.program,"uModelViewMatrix"),!1,this.getModelViewMatrix(0));var u=t.points.length;this.context.drawElements(this.context.TRIANGLES,u,this.context.UNSIGNED_SHORT,0),this.context.viewport(0,0,this.width,this.height)},e}(s),E=function(){function t(){this.models=[]}return t.prototype.getModels=function(){return this.models},t.prototype.addModel=function(t){this.models.push(t)},t}(),M=function(){function t(t){switch(this.isLooping=!1,this.isDebug=!1,this.models=[],t){case"svg":this.context=new x;break;case"canvas":this.context=new y;break;case"webgl":this.context=new C;break;default:this.context=t}this.dataProvider=new E,this.camera=new b(this.context)}return t.prototype.getContext=function(){return this.context},t.prototype.getCamera=function(){return this.camera},t.prototype.requestPointerLock=function(){this.context.domElement.requestPointerLock()},t.prototype.debug=function(){this.isDebug=!0,this.camera.setDebug(!0),this.context.setDebug(!0)},t.prototype.debugger=function(){return this.isDebug?(this.isDebug=!1,this.camera.setDebug(!1),this.context.setDebug(!1),!0):this.isDebug},t.prototype.update=function(){var t=this;this.context.clear();var e=this.models.map((function(e,n){var o=e.getPosition(),r=e.getPoints();return e.getPolygons().map((function(i,s){var a=i.map((function(e){var n=r[e];return t.camera.transformPointToCameraView({x:o.x+n.x-t.camera.getPosition().x,y:o.y+n.y-t.camera.getPosition().y,z:o.z+n.z-t.camera.getPosition().z})})),c=new h(a);return c.setId("".concat(e.getId(),".").concat(s)),c.color="hsla(".concat(100*n+15*s,", 100%, 50%, 1)"),c}))})).flat();this.context.renderPolygons(e,this.camera),this.debugger()},t.prototype.add=function(t,e,n){n&&t.setId(n),e&&t.setPosition(e),this.models.push(t),this.context.addModel(t),this.dataProvider.addModel(t)},t.prototype.remove=function(t){this.models=this.models.filter((function(e){return e!==t})),this.context.removeModel(t)},t.prototype.run=function(t){for(var e=t.getBoundingClientRect(),n=e.width,o=e.height;t.firstChild;)t.removeChild(t.firstChild);t.append(this.context.domElement),this.context.setSizes(n,o),this.isLooping||(this.isLooping=!0,this.loop())},t.prototype.stop=function(){this.isLooping=!1},t.prototype.loop=function(){var t=this;this.isLooping&&window.requestAnimationFrame((function(){t.update(),t.loop()}))},t}(),k=(function(){function t(){this.listeners={}}t.prototype.addEventListener=function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},t.prototype.removeEventListener=function(t,e){if(this.listeners[t]){var n=this.listeners[t].indexOf(e);-1!==n&&this.listeners[t].splice(n,1)}},t.prototype.dispatch=function(t){this.listeners[t.type]&&this.listeners[t.type].forEach((function(e){return e(t)}))}}(),function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}()),j=(function(t){function e(e,n){var o=t.call(this,n)||this;return o.radius=e,o}k(e,t)}(P),function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}()),D=function(t){function e(e,n,o,r){var i=t.call(this,r)||this;return i.width=e,i.height=n,i.depth=o,i.points=[{x:-e/2,y:-n/2,z:-o/2},{x:e/2,y:-n/2,z:-o/2},{x:e/2,y:n/2,z:-o/2},{x:-e/2,y:n/2,z:-o/2},{x:-e/2,y:-n/2,z:o/2},{x:e/2,y:-n/2,z:o/2},{x:e/2,y:n/2,z:o/2},{x:-e/2,y:n/2,z:o/2}],i.polygons=[[0,1,2,3],[1,2,6,5],[4,5,6,7],[0,4,7,3],[7,3,2,6],[0,1,5,4]],i}return j(e,t),e}(P),L=n(409),_=n(8903),S=n(2518),F=n(1165),R=n(9379),I=n(2839);const N=t=>{const{name:e}=t,{formState:{isSubmitting:n}}=(0,I.xW)(),{field:o}=(0,I.as)({name:e});return{field:(0,R.A)((0,R.A)({},o),n?{disabled:!0}:{})}};var V=n(579);const O=t=>{const{label:e,options:n,name:o}=t,{field:{disabled:r,value:i,onChange:s}}=N({name:o});return(0,V.jsx)(F.A,{title:e,disabled:r,children:n.map(((t,e)=>(0,V.jsx)(S.A,{color:t.value===i?"success":"info",disabled:t.disabled,value:t.value,onClick:()=>s(t.value),children:t.label},e)))})};var T=n(9070);const B=t=>{const{required:e,label:n,marks:r,min:i,max:s,step:a,name:c}=t,{field:{value:u=0,onChange:h}}=N({required:e,name:c}),l=(0,o.useCallback)(((t,e)=>{h(e)}),[h]);return(0,V.jsxs)(_.Ay,{container:!0,spacing:1,alignItems:"center",children:[(0,V.jsx)(_.Ay,{item:!0,container:!0,width:55,justifyContent:"flex-end",children:(0,V.jsx)(_.Ay,{item:!0,children:u.toFixed(2)})}),(0,V.jsx)(_.Ay,{item:!0,xs:!0,children:(0,V.jsx)(T.Ay,{title:n,marks:r,min:i,max:s,step:a,value:u,onChange:l})})]})};var Y=n(3579);const H=t=>{const{required:e,name:n}=t,{field:{value:r=!1,disabled:i,ref:s,onChange:a,onBlur:c}}=N({required:e,name:n}),u=(0,o.useCallback)(((t,e)=>{a(e)}),[a]);return(0,V.jsx)(Y.A,{ref:s,disabled:i,checked:r,onBlur:c,onChange:u})},U=()=>(0,V.jsxs)(_.Ay,{container:!0,spacing:1,children:[(0,V.jsx)(_.Ay,{item:!0,xs:12,children:(0,V.jsx)(O,{label:"Context",options:[{label:"SVG",value:"svg"},{label:"Canvas",value:"canvas"},{label:"WebGL",value:"webgl"}],name:"context"})}),(0,V.jsx)(_.Ay,{item:!0,xs:12,children:(0,V.jsx)(H,{name:"isRunning"})}),(0,V.jsx)(_.Ay,{item:!0,xs:12,children:(0,V.jsx)(B,{label:"FOV",min:0,max:200,name:"fov"})}),(0,V.jsx)(_.Ay,{item:!0,xs:12,children:(0,V.jsx)(B,{label:"Pitch",min:-90,max:90,name:"pitch"})}),(0,V.jsx)(_.Ay,{item:!0,xs:12,children:(0,V.jsx)(B,{label:"Yaw",min:-180,max:180,name:"yaw"})}),(0,V.jsxs)(_.Ay,{container:!0,item:!0,xs:6,spacing:1,children:[(0,V.jsx)(_.Ay,{item:!0,xs:12,children:(0,V.jsx)(B,{label:"Position X",marks:[{label:"-100",value:-100},{label:"0",value:0},{label:"100",value:100}],min:-100,max:100,name:"position.x"})}),(0,V.jsx)(_.Ay,{item:!0,xs:12,children:(0,V.jsx)(B,{label:"Position Y",marks:[{label:"-100",value:-100},{label:"0",value:0},{label:"100",value:100}],min:-100,max:100,name:"position.y"})}),(0,V.jsx)(_.Ay,{item:!0,xs:12,children:(0,V.jsx)(B,{label:"Position Z",marks:[{label:"-100",value:-100},{label:"0",value:0},{label:"100",value:100}],min:-100,max:100,name:"position.z"})})]}),(0,V.jsxs)(_.Ay,{container:!0,item:!0,xs:6,spacing:1,children:[(0,V.jsx)(_.Ay,{item:!0,xs:12,children:(0,V.jsx)(B,{label:"Direction X",marks:[{label:"-1",value:-1},{label:"0",value:0},{label:"1",value:1}],min:-1,max:1,step:.01,name:"direction.x"})}),(0,V.jsx)(_.Ay,{item:!0,xs:12,children:(0,V.jsx)(B,{label:"Direction Y",marks:[{label:"-1",value:-1},{label:"0",value:0},{label:"1",value:1}],min:-1,max:1,step:.01,name:"direction.y"})}),(0,V.jsx)(_.Ay,{item:!0,xs:12,children:(0,V.jsx)(B,{label:"Direction Z",marks:[{label:"-1",value:-1},{label:"0",value:0},{label:"1",value:1}],min:-1,max:1,step:.01,name:"direction.z"})})]})]}),W=(0,o.createContext)({context:"webgl",setContext(){},isRunning:!1,setRunning(){},fov:100,setFov(){},pitch:0,setPitch(){},yaw:0,setYaw(){},direction:{x:1,y:0,z:0},setDirection(){},position:{x:0,y:0,z:0},setPosition(){},addEventListener(){},removeEventListener(){}}),q=t=>{const{children:e}=t,[n,s]=(0,o.useState)(!1),[a,c]=(0,o.useState)(!0),[u,h]=(0,o.useState)("canvas"),[l,p]=(0,o.useState)(45),[f,y]=(0,o.useState)(0),[g,x]=(0,o.useState)(0),[d,m]=(0,o.useState)({x:0,y:0,z:300}),[b,w]=(0,o.useState)({x:0,y:0,z:-1}),P=(0,o.useRef)(new v),z=(0,o.useRef)(null),A=(0,o.useCallback)((()=>{s(!1)}),[]),C=(0,o.useCallback)(((t,e)=>JSON.stringify(t)!==JSON.stringify(e)),[]),E=(0,o.useCallback)((t=>{m(t)}),[]),M=(0,o.useCallback)((t=>{w(t)}),[]),k=(0,o.useCallback)(((t,e)=>{P.current.addEventListener(t,e)}),[]),j=(0,o.useCallback)(((t,e)=>{P.current.removeEventListener(t,e)}),[]),D=(0,o.useCallback)((t=>{C(u,t.context)&&(h(t.context),P.current.emit("changeContext",{data:t})),C(a,t.isRunning)&&(c(t.isRunning),P.current.emit("changeRunning",{data:t})),C(d,t.position)&&(m(t.position),P.current.emit("changePosition",{data:t})),C(b,t.direction)&&(w(t.direction),P.current.emit("changeDirection",{data:t})),C(l,t.fov)&&(p(t.fov),P.current.emit("changeFov",{data:t})),C(f,t.pitch)&&(y(t.pitch),P.current.emit("changePitch",{data:t})),C(g,t.yaw)&&(x(t.yaw),P.current.emit("changeYaw",{data:t}))}),[u,d,b,l,f,g,f]);return(0,o.useEffect)((()=>{const t=t=>{"p"===t.key&&(s((t=>!t)),t.preventDefault())};return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}}),[]),(0,V.jsxs)(W.Provider,{value:{context:u,setContext:h,isRunning:a,setRunning:c,fov:l,setFov:p,pitch:f,setPitch:y,yaw:g,setYaw:x,direction:b,setDirection:M,position:d,setPosition:E,addEventListener:k,removeEventListener:j},children:[(0,V.jsx)(r.Ay,{sx:{width:"50vw"},PaperProps:{sx:{width:"50vw",padding:2}},open:n,anchor:"right",onClose:A,children:(0,V.jsx)(L.lV,{ref:z,mode:"onSubmit",values:{context:u,isRunning:a,fov:l,pitch:f,yaw:g,position:d,direction:b},shouldUnregister:!0,onChange:D,children:(0,V.jsx)(i.A,{sx:{paddingLeft:2,paddingRight:2},children:(0,V.jsx)(U,{})})})}),e]})};class G extends P{constructor(t){super(t),this.points=[],this.polygons=[]}addPolygon(t){const e=[];for(let n=0;n<t.points.length;n++)e.push(this.points.length),this.points.push(t.points[n]);this.polygons.push(e)}addLine(t,e){const n=this.points.length;this.points.push(t),this.points.push(e),this.polygons.push([n,n+1])}getPolygons(){return this.polygons}}const X=()=>{const[t,e]=(0,o.useState)(!1),n=(0,o.useRef)(null),r=(0,o.useRef)(),i=(0,o.useContext)(W),s=(0,o.useCallback)((()=>{r.current&&r.current.requestPointerLock()}),[]),a=(0,o.useCallback)((t=>{const e=r.current;e&&(console.clear(),e.debug(),t.preventDefault(),t.stopPropagation())}),[]);return(0,o.useEffect)((()=>{if(!n.current)return;const t=r.current=new M(i.context);window.scene=t,window.context=t.getContext(),window.camera=t.getCamera();const e=t.getCamera();e.setPitch(i.pitch),e.setYaw(i.yaw),e.setPosition(i.position),e.setFov(i.fov);const o=new G({x:0,y:0,z:0});new h([{x:-100,y:-10,z:-10},{x:0,y:90,z:-10},{x:100,y:-10,z:-10}]).setId("a");new h([{x:-10,y:0,z:-90},{x:-10,y:120,z:0},{x:-10,y:0,z:90}]).setId("b");return new h([{x:-30,y:0,z:-20},{x:-20,y:50,z:0},{x:-10,y:0,z:-10}]).setId("c"),o.addPolygon(new h([{x:-100,y:100,z:0},{x:0,y:0,z:0},{x:100,y:100,z:0},{x:100,y:-100,z:0},{x:-100,y:-100,z:0}])),o.setId("lines"),t.add(new D(100,100,100),{x:0,y:0,z:0},"cube"),t.run(n.current),()=>{t.stop()}}),[i.context]),(0,o.useEffect)((()=>{const t=()=>{const t=!!document.pointerLockElement;e(t)},n=t=>{r.current&&"f"===t.key&&(console.clear(),r.current.debug(),t.preventDefault())},o=t=>{if(r.current&&t.altKey){switch(t.key){case"1":i.setContext("svg");break;case"2":i.setContext("canvas");break;case"3":i.setContext("webgl");break;default:return}t.preventDefault()}};return document.addEventListener("pointerlockchange",t),document.addEventListener("keydown",n),document.addEventListener("keydown",o),()=>{document.removeEventListener("pointerlockchange",t),document.removeEventListener("keydown",n),document.removeEventListener("keydown",o)}}),[]),(0,o.useEffect)((()=>{let t,e,n,o,i,s;const a=a=>{if(!r.current)return;const c=r.current,u=c.getCamera();let h=u.getPosition();switch(a.key){case"ArrowUp":u.setPosition((0,R.A)((0,R.A)({},h),{},{z:h.z+1}));break;case"ArrowDown":u.setPosition((0,R.A)((0,R.A)({},h),{},{z:h.z-1}));break;case"ArrowLeft":u.setPosition((0,R.A)((0,R.A)({},h),{},{x:h.x+1}));break;case"ArrowRight":u.setPosition((0,R.A)((0,R.A)({},h),{},{x:h.x-1}));break;case"w":clearInterval(t),t=setInterval((()=>{const t=c.getCamera();t.setPosition({x:t.getPosition().x-t.getDirection().x,y:t.getPosition().y-t.getDirection().y,z:t.getPosition().z-t.getDirection().z})}),0),a.preventDefault(),a.stopPropagation();break;case"a":clearInterval(n),n=setInterval((()=>{const t=c.getCamera();t.setPosition({x:t.getPosition().x+t.getDirectionLeft().x,y:t.getPosition().y+t.getDirectionLeft().y,z:t.getPosition().z+t.getDirectionLeft().z})}),0),a.preventDefault(),a.stopPropagation();break;case"d":clearInterval(o),o=setInterval((()=>{const t=c.getCamera();t.setPosition({x:t.getPosition().x-t.getDirectionLeft().x,y:t.getPosition().y-t.getDirectionLeft().y,z:t.getPosition().z-t.getDirectionLeft().z})}),0),a.preventDefault(),a.stopPropagation();break;case"s":clearInterval(e),e=setInterval((()=>{const t=c.getCamera();t.setPosition({x:t.getPosition().x+t.getDirection().x,y:t.getPosition().y+t.getDirection().y,z:t.getPosition().z+t.getDirection().z})}),0),a.preventDefault(),a.stopPropagation();break;case"q":clearInterval(s),s=setInterval((()=>{const t=c.getCamera(),e=t.getPosition();t.setPosition((0,R.A)((0,R.A)({},e),{},{y:e.y-1}))}),0),a.preventDefault(),a.stopPropagation();break;case"e":clearInterval(i),i=setInterval((()=>{const t=c.getCamera(),e=t.getPosition();t.setPosition((0,R.A)((0,R.A)({},e),{},{y:e.y+1}))}),0),a.preventDefault(),a.stopPropagation()}},c=r=>{switch(r.key){case"w":clearInterval(t);break;case"a":clearInterval(n);break;case"d":clearInterval(o);break;case"s":clearInterval(e);break;case"q":clearInterval(s);break;case"e":clearInterval(i)}};return document.addEventListener("keypress",a),document.addEventListener("keyup",c),()=>{document.removeEventListener("keypress",a),document.removeEventListener("keyup",c)}}),[]),(0,o.useEffect)((()=>{if(!t)return;const e=t=>{if(!r.current)return;const e=r.current.getCamera();e.setDirectionFromAngles(e.getPitch()+.1*t.movementY,e.getYaw()-.1*t.movementX)};return document.addEventListener("mousemove",e),()=>{document.removeEventListener("mousemove",e)}}),[t]),(0,o.useEffect)((()=>{if(!r.current)return;const t=r.current.getCamera(),e=t=>{const{position:e}=t;i.setPosition(e)},n=t=>{const{direction:e,yaw:n,pitch:o}=t;i.setDirection(e),i.setPitch(o),i.setYaw(n)},o=t=>{const{fov:e}=t;i.setFov(e)};return t.addEventListener("positionChange",e),t.addEventListener("directionChange",n),t.addEventListener("fovChange",o),()=>{t.removeEventListener("positionChange",e),t.removeEventListener("directionChange",n),t.removeEventListener("fovChange",o)}}),[i]),(0,o.useEffect)((()=>{const t=t=>{if(!n.current||!r.current)return;const e=r.current;t.data.isRunning?e.run(n.current):e.stop()},e=t=>{if(!r.current)return;const e=r.current.getCamera(),{data:{position:n}}=t;e.setPosition(n)},o=t=>{if(!r.current)return;const e=r.current.getCamera(),{data:{direction:n}}=t;e.setDirection(n)},s=t=>{if(!r.current)return;const e=r.current.getCamera(),{data:{fov:n}}=t;e.setFov(n)},a=t=>{if(!r.current)return;const e=r.current.getCamera(),{data:{pitch:n}}=t;e.setPitch(n)},c=t=>{if(!r.current)return;const e=r.current.getCamera(),{data:{yaw:n}}=t;e.setYaw(n)};return i.addEventListener("changeRunning",t),i.addEventListener("changePosition",e),i.addEventListener("changeDirection",o),i.addEventListener("changeFov",s),i.addEventListener("changeYaw",c),i.addEventListener("changePitch",a),()=>{i.removeEventListener("changeRunning",t),i.removeEventListener("changePosition",e),i.removeEventListener("changeDirection",o),i.removeEventListener("changeFov",s),i.removeEventListener("changeYaw",c),i.removeEventListener("changePitch",a)}}),[i]),(0,V.jsx)("div",{ref:n,style:{width:"100%",height:"calc(100vh - 55px)"},onClick:s,onContextMenu:a})},$=()=>(0,V.jsx)(q,{children:(0,V.jsx)(X,{})})}}]);
//# sourceMappingURL=554.53619fe8.chunk.js.map