"use strict";(self.webpackChunkkearisp=self.webpackChunkkearisp||[]).push([[473],{2473:(t,e,n)=>{n.r(e),n.d(e,{default:()=>Y});var o=n(2791),r=n(2787),i=n(697),s=function(){function t(){this.width=0,this.height=0}return t.prototype.getWidth=function(){return this.width},t.prototype.getHeight=function(){return this.height},t.prototype.setWidth=function(t){this.width=t},t.prototype.setHeight=function(t){this.height=t},t}(),a=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),c=function(t){function e(){var e=t.call(this)||this;return e.canvas=document.createElement("canvas"),e.context=e.canvas.getContext("2d"),e}return a(e,t),e.prototype.setStrokeStyle=function(t){this.context.strokeStyle=t},e.prototype.setFillStyle=function(t){this.context.fillStyle=t},e.prototype.drawLine=function(t,e){this.context.lineWidth=.5,this.context.beginPath(),this.context.moveTo(t.x,t.y),this.context.lineTo(e.x,e.y),this.context.stroke(),this.context.closePath()},e.prototype.fillRect=function(t,e,n,o){this.context.fillRect(t,e,n,o)},e.prototype.fillPolygon=function(t){this.context.beginPath();var e=t[0],n=t.slice(1);this.context.moveTo(e.x,e.y);for(var o=0;o<n.length;o++)this.context.lineTo(n[o].x,n[o].y);this.context.closePath(),this.context.stroke(),this.context.fill()},e.prototype.clear=function(){this.context.clearRect(0,0,this.getWidth(),this.getHeight())},e.prototype.requestPointerLock=function(){return this.canvas.requestPointerLock()},e.prototype.render=function(t){var e=t.getBoundingClientRect(),n=e.width,o=e.height;this.canvas.width=n,this.canvas.height=o,t.append(this.canvas)},e}(s),u=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),h=function(t){function e(){var e=t.call(this)||this;return e.strokeStyle="#FFFFFF",e.fillStyle="#FFFFFF",e.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),e.svg.setAttribute("width","100%"),e.svg.setAttribute("height","100%"),e}return u(e,t),e.prototype.createSVGElement=function(t){return document.createElementNS("http://www.w3.org/2000/svg",t)},e.prototype.setStrokeStyle=function(t){this.strokeStyle=t},e.prototype.setFillStyle=function(t){this.fillStyle=t},e.prototype.drawLine=function(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1","".concat(t.x)),n.setAttribute("y1","".concat(t.y)),n.setAttribute("x2","".concat(e.x)),n.setAttribute("y2","".concat(e.y)),n.setAttribute("stroke",this.strokeStyle),n.setAttribute("stroke-width","1"),this.svg.appendChild(n)},e.prototype.fillRect=function(t,e,n,o){var r=document.createElementNS("http://www.w3.org/2000/svg","rect");r.setAttribute("x","".concat(t)),r.setAttribute("y","".concat(e)),r.setAttribute("width","".concat(n)),r.setAttribute("height","".concat(o)),r.setAttribute("fill",this.fillStyle),this.svg.appendChild(r)},e.prototype.fillPolygon=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","polygon");e.setAttribute("style","fill: ".concat(this.fillStyle)),e.setAttribute("points",t.map((function(t){return"".concat(t.x,",").concat(t.y)})).join(" ")),e.setAttribute("stroke-width","0.9"),e.setAttribute("stroke","black"),this.svg.append(e)},e.prototype.clear=function(){for(;this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild)},e.prototype.requestPointerLock=function(){return this.svg.requestPointerLock()},e.prototype.render=function(t){t.append(this.svg)},e}(s),l=function(){function t(t,e,n){this.x=t,this.y=e,this.z=n}return Object.defineProperty(t.prototype,"distance",{get:function(){return t.distance(this)},enumerable:!1,configurable:!0}),t.prototype.set=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},t.prototype.add=function(e){return this.set(t.summary(this,e)),this},t.prototype.multiply=function(e){return this.set(t.multiply(this,e)),this},t.prototype.sub=function(e){return this.set(t.subtract(this,e)),this},t.prototype.normalize=function(){var e=t.normalize(this),n=e.x,o=e.y,r=e.z;return this.x=n,this.y=o,this.z=r,this},t.prototype.toPoint=function(){return{x:this.x,y:this.y,z:this.z}},t.fromPoint=function(e){return new t(e.x,e.y,e.z)},t.summary=function(t,e){return{x:t.x+e.x,y:t.y+e.y,z:t.z+e.z}},t.subtract=function(t,e){return{x:t.x-e.x,y:t.y-e.y,z:t.z-e.z}},t.cross=function(t,e){return{x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}},t.distance=function(t){return Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)+Math.pow(t.z,2))},t.normalize=function(t){var e=Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)+Math.pow(t.z,2));return{x:t.x/e,y:t.y/e,z:t.z/e}},t.magnitude=function(e){return Math.sqrt(t.dot(e,e))},t.angle=function(e,n){var o=t.magnitude(e),r=t.magnitude(n),i=t.dot(e,n);return Math.acos(i/(o*r))},t.multiply=function(t,e){return{x:t.x*e,y:t.y*e,z:t.z*e}},t.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},t.intersectPlaneV1=function(e,n,o,r,i){var s=t.subtract(r,o),a=t.subtract(i,o),c=t.cross(s,a),u=t.dot(c,n);if(Math.abs(u)<1e-7)return null;var h=t.dot(c,t.subtract(o,e))/u;return h<0?null:t.summary(e,t.multiply(n,h))},t.intersectPlaneV2=function(e,n,o,r,i){var s=t.subtract(r,o),a=t.subtract(i,o),c=t.cross(s,a),u=-t.dot(c,o),h=t.dot(c,n);if(Math.abs(h)<1e-6)return null;var l=-(t.dot(c,e)+u)/h;return t.summary(e,t.multiply(n,l))},t.intersectPolygon=function(e,n,o){var r=-t.dot(o.getNormal(),o.points[0]),i=-(t.dot(o.getNormal(),e)+r)/t.dot(o.getNormal(),n);if(isNaN(i)||!isFinite(i))return null;var s=t.summary(t.multiply(n,i),e);!isNaN(s.x)&&isFinite(s.x)||console.log(e,i,s);for(var a=0;a<o.points.length;a++){var c=o.points[a],u=o.points[(a+1)%o.points.length],h=t.subtract(u,c),l=t.subtract(s,c),p=t.cross(h,l);if(t.dot(o.getNormal(),p)<=1)return null}return s},t.areCoDirected=function(t,e){var n=t.x/e.x,o=t.y/e.y,r=t.z/e.z;if(isNaN(n)||isNaN(o)||isNaN(r))return!1;var i=Math.pow(10,-14);return!(Math.abs(n-o)>i||Math.abs(n-r)>i||Math.abs(o-r)>i)},t}(),p=function(t,e,n){if(n||2===arguments.length)for(var o,r=0,i=e.length;r<i;r++)!o&&r in e||(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))},f=function(){function t(t,e){this.points=t,this.normal=e||this.calcNormal()}return t.prototype.setId=function(t){this.id=t},t.prototype.intersects=function(e){for(var n=0,o=p(p([],t.getNormals(this.points),!0),t.getNormals(e.points),!0);n<o.length;n++){var r=o[n],i=t.projection(this.points,r),s=t.projection(e.points,r);if(i.max<s.min||s.max<i.min)return!1;if(i.max===s.min||s.max===i.min)return!1}return!0},t.prototype.smooth=function(){return[]},t.prototype.getNormal=function(){return this.normal},t.prototype.calcNormal=function(){for(var t={x:0,y:0,z:0},e=0;e<this.points.length;e++){var n=this.points[e],o=this.points[(e+1)%this.points.length],r=this.points[(e+2)%this.points.length],i=l.subtract(n,o),s=l.subtract(n,r),a=l.cross(i,s);t=l.summary(t,a)}return l.normalize({x:t.x/this.points.length,y:t.y/this.points.length,z:t.z/this.points.length})},t.prototype.getCenter=function(){for(var t={x:0,y:0,z:0},e=0;e<this.points.length;e++)t=l.summary(this.points[e],t);return{x:t.x/this.points.length,y:t.y/this.points.length,z:t.z/this.points.length}},t.prototype.isOnSamePlane=function(t){var e=this.points[0];if(!e)return!1;var n=this.getNormal(),o=l.dot(l.subtract(t,e),n);return Math.abs(o)<1e-4},t.prototype.isContainPointV1=function(t){for(var e=!1,n=0;n<this.points.length;n++){var o=this.points[n],r=this.points[(n+1)%this.points.length],i=this.points[(n+2)%this.points.length],s=l.subtract(i,o),a=l.subtract(r,o),c=l.subtract(t,o),u=l.dot(s,s),h=l.dot(s,a),p=l.dot(s,c),f=l.dot(a,a),y=l.dot(a,c),d=1/(u*f-h*h),g=(f*p-h*y)*d,v=(u*y-h*p)*d;if(g>=0&&v>=0&&g+v<1){e=!0;break}}return e},t.prototype.isContainPointV2=function(t){for(var e=0,n=0;n<this.points.length;n++){var o=this.points[n],r=this.points[(n+1)%this.points.length],i=l.subtract(r,o),s=l.dot(i,l.subtract(t,o))/l.dot(i,i),a=1e-6;s>a&&s<.999999&&(e+=l.angle(l.subtract(r,t),l.subtract(o,t)))}return Math.abs(e-2*Math.PI)<=.01},t.prototype.isContainPointV3=function(t){for(var e=0;e<this.points.length;e++){var n=this.points[e],o=this.points[(e+1)%this.points.length],r=l.subtract(o,n),i=l.subtract(t,n),s=l.cross(r,i);if(l.dot(this.getNormal(),s)<=-1)return!1}return!0},t.isIntersect=function(t,e){return!1},t.intersect=function(e,n,o){for(var r=[],i=[],s=!0,a=0;a<e.points.length;a++){var c=e.points[a],u=e.points[(a+1)%e.points.length],h=l.subtract(u,c);s?r.push(c):i.push(c);for(var p=0;p<n.points.length;p++){var f=n.points[p],y=n.points[(p+1)%n.points.length],d=n.points[(p+2)%n.points.length],g=l.intersectPlaneV2(c,h,f,y,d);if(!(g&&l.distance(l.subtract(c,g))<0)&&(g&&e.isContainPointV3(g))){o&&console.log("intersectPoint:",g),r.push(g),i.push(g),s=!s;break}}}if(0===i.length)return[e];var v=new t(r);v.setId("".concat(e.id,".before")),v.color=e.color;var x=new t(i);return x.setId("".concat(e.id,".after")),x.color=e.color,[v,x]},t.getNormals=function(t){for(var e=[],n=0;n<t.length;n++){var o=t[n],r=t[(n+1)%t.length],i={x:r.x-o.x,y:r.y-o.y,z:r.z-o.z},s={x:-i.y,y:i.x,z:i.z};e.push(s)}return e},t.projection=function(t,e){for(var n=e.x*t[0].x+e.y*t[0].y,o=n,r=1;r<t.length;r++){var i=e.x*t[r].x+e.y*t[r].y;i<n?n=i:i>o&&(o=i)}return{min:n,max:o}},t}(),y=function(){function t(e,n){var o=e[0],r=e.slice(1);void 0===n&&(n=!1),this.debug=!1,this.root=o,this.debug=n;for(var i=[],s=[],a=0,c=r;a<c.length;a++)for(var u=c[a],h=0,l=f.intersect(u,o,this.debug);h<l.length;h++){var p=l[h],y=this.classifyPolygon(p);switch(y){case"front":i.push(p);break;case"back":s.push(p);break;case"coplanar":this.debug&&console.log(y,this.root,p)}}this.front=i.length>0?new t(i,this.debug):null,this.back=s.length>0?new t(s,this.debug):null}return t.prototype.classifyPolygon=function(t){return this.classifyPolygonV4(t)},t.prototype.classifyPolygonV1=function(t){var e=1e-5,n=l.dot(this.root.getNormal(),t.getNormal());return n>e?"front":n<-1e-5?"back":"coplanar"},t.prototype.classifyPolygonV2=function(t){return l.dot(this.root.getNormal(),t.getNormal())>0?"front":"back"},t.prototype.classifyPolygonV3=function(t){return this.root.getCenter().z>t.getCenter().z?"front":"back"},t.prototype.classifyPolygonV4=function(t){return this.isInFrontV3(t)?"front":"back"},t.prototype.isInFront=function(t,e){var n=this.root.getCenter();return!(l.dot(n,e)<0)&&l.dot(n,this.root.getNormal())>0},t.prototype.isInFrontV2=function(t){return this.root.getCenter().z>t.getCenter().z},t.prototype.isInFrontV3=function(t){var e=l.subtract(this.root.getCenter(),t.getCenter());return l.dot(this.root.getNormal(),e)<0},t.prototype.traverse=function(t,e,n){this.root&&this.traverseV4(e,n)},t.prototype.traverseV1=function(t,e,n){var o=this.isInFront(t,e)?"front":"back";switch("back"===o&&"back"===this.classifyPolygon(this.root)&&(o="front"),o){case"front":this.back&&this.back.traverseV1(t,e,n),n(this.root),this.front&&this.front.traverseV1(t,e,n);break;case"back":this.front&&this.front.traverseV1(t,e,n),n(this.root),this.back&&this.back.traverseV1(t,e,n)}},t.prototype.traverseV2=function(t,e,n){l.areCoDirected(e,this.root.getNormal())?l.dot(t,this.root.getNormal())>=0?(this.back&&this.back.traverseV2(t,e,n),n(this.root),this.front&&this.front.traverseV2(t,e,n)):this.front&&this.front.traverseV2(t,e,n):l.dot(t,this.root.getNormal())>=0?(this.front&&this.front.traverseV2(t,e,n),n(this.root),this.back&&this.back.traverseV2(t,e,n)):this.back&&this.back.traverseV2(t,e,n)},t.prototype.traverseV3=function(t,e,n){l.areCoDirected(e,this.root.getNormal())?l.dot(t,this.root.getNormal())>=0?this.front&&this.front.traverseV3(t,e,n):(this.front&&this.front.traverseV3(t,e,n),n(this.root),this.back&&this.back.traverseV3(t,e,n)):l.dot(t,this.root.getNormal())>=0?(this.back&&this.back.traverseV3(t,e,n),n(this.root),this.front&&this.front.traverseV3(t,e,n)):this.back&&this.back.traverseV3(t,e,n)},t.prototype.traverseV4=function(t,e){l.dot(this.root.getNormal(),t)<0?(this.front&&this.front.traverseV4(t,e),e(this.root),this.back&&this.back.traverseV4(t,e)):(this.back&&this.back.traverseV4(t,e),e(this.root),this.front&&this.front.traverseV4(t,e))},t}(),d=function(){function t(){this.listeners={}}return t.prototype.addEventListener=function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},t.prototype.removeEventListener=function(t,e){if(this.listeners[t]){var n=this.listeners[t].indexOf(e);-1!==n&&this.listeners[t].splice(n,1)}},t.prototype.emit=function(t,e){this.listeners[t]&&this.listeners[t].forEach((function(t){return t(e)}))},t}(),g=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),v=function(t,e,n){if(n||2===arguments.length)for(var o,r=0,i=e.length;r<i;r++)!o&&r in e||(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))},x=function(t){function e(e,n,o,r){void 0===o&&(o={x:0,y:0,z:0}),void 0===r&&(r={x:0,y:0,z:1});var i=t.call(this)||this;return i.context=e,i.dataProvider=n,i.debug=!1,i.isRunning=!1,i.fov=100,i.pitch=0,i.yaw=0,i.roll=0,i.position=l.fromPoint(o),i.direction=l.fromPoint(r),i.rotationMatrix=i.calcDirectionMatrix(),i}return g(e,t),e.prototype.getPosition=function(){return this.position},e.prototype.setPosition=function(t){this.position.set(t),this.rotationMatrix=this.calcDirectionMatrix(),this.emit("positionChange",{position:this.position})},e.prototype.calcDirectionMatrix=function(){return function(t,e,n){void 0===n&&(n={x:0,y:1,z:0});var o=l.normalize(l.cross(n,e)),r=l.normalize(l.cross(e,o));return[[o.x,r.x,e.x,t.x],[o.y,r.y,e.y,t.y],[o.z,r.z,e.z,t.z],[0,0,0,1]]}(this.position,this.direction)},e.prototype.rotatePoint=function(t){return this.transformPointToCameraView(t)},e.prototype.getModels=function(){return this.dataProvider.getModels()},e.prototype.transformPointToCameraView=function(t){var e=this.rotationMatrix;return{x:(t.x*e[0][0]+t.y*e[1][0]+t.z*e[2][0]+e[3][0])/1,y:(t.x*e[0][1]+t.y*e[1][1]+t.z*e[2][1]+e[3][1])/1,z:(t.x*e[0][2]+t.y*e[1][2]+t.z*e[2][2]+e[3][2])/1}},e.prototype.projectPoint=function(t){var e=t.x,n=t.y,o=t.z;if(o/3<=-this.fov)return{x:NaN,y:NaN};var r=this.fov/(this.fov+o/3);return{x:r*e,y:r*n}},e.prototype.getFov=function(){return this.fov},e.prototype.setFov=function(t){this.fov=t,this.emit("fovChange",{fov:this.fov})},e.prototype.getDirection=function(){return this.direction},e.prototype.getDirectionLeft=function(){return l.cross(this.direction,{x:0,y:1,z:0})},e.prototype.setDirection=function(t){this.direction.set(t),this.rotationMatrix=this.calcDirectionMatrix(),this.emit("directionChange",{direction:this.direction,pitch:this.pitch,yaw:this.yaw})},e.prototype.setDirectionFromAngles=function(t,e){this.pitch=Math.max(Math.min(t,90),-90),this.yaw=e;var n=this.pitch*(Math.PI/180),o=this.yaw*(Math.PI/180);this.setDirection({x:Math.cos(n)*Math.sin(o),y:Math.sin(n),z:Math.cos(n)*Math.cos(o)})},e.prototype.getYaw=function(){return this.yaw},e.prototype.getPitch=function(){return this.pitch},e.prototype.setPitch=function(t){this.setDirectionFromAngles(t,this.yaw)},e.prototype.setYaw=function(t){this.setDirectionFromAngles(this.pitch,t)},e.prototype.getRoll=function(){return this.roll},e.prototype.setRoll=function(t){this.roll=t},e.prototype.update=function(){var t=this;this.context.clear();var e=this.getModels().reduce((function(e,n,o){var r=n.getPosition(),i=n.getPoints();return v(v([],e,!0),n.getPolygons().map((function(e,s){var a=e.map((function(e){var n=i[e];return t.transformPointToCameraView({x:r.x+n.x-t.position.x,y:r.y+n.y-t.position.y,z:r.z+n.z-t.position.z})})),c=new f(a);return c.setId("#".concat(n.getId(),".").concat(s)),c.color="hsl(".concat(100*o+15*s,", 100%, 50%)"),c})),!0)}),[]);new y(e,this.debug).traverse({x:0,y:0,z:0},{x:0,y:0,z:-1},(function(e){t.debug&&console.log(e.id);var n=e.points.map((function(e){var n=t.projectPoint(e),o=n.x,r=n.y;return{x:t.context.getWidth()/2+o,y:t.context.getHeight()/2-r}})).filter((function(t){return isNaN(t.x)||isNaN(t.y),!isNaN(t.x)&&!isNaN(t.y)}));n.length>0&&(t.context.setStrokeStyle("#335555"),t.context.setFillStyle(e.color||"#CC0000"),t.context.fillPolygon(n))})),this.debug&&(this.debug=!1)},e.prototype.run=function(){this.isRunning=!0,this.loop()},e.prototype.destroy=function(){this.isRunning=!1},e.prototype.activateDebug=function(){this.debug=!0},e.prototype.loop=function(){var t=this;this.isRunning&&requestAnimationFrame((function(){t.update(),t.loop()}))},e}(d),m=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),b=function(t){function e(e){var n=t.call(this)||this;return n.scale=1,n.rotation=0,n.rotationDirection={x:0,y:1,z:0},n.points=[],n.polygons=[],n.position=e||{x:0,y:0,z:0},n.rotationMatrix=n.calcDirectionMatrix(),n}return m(e,t),e.prototype.getId=function(){return this.id},e.prototype.setId=function(t){this.id=t},e.prototype.getPosition=function(){return this.position},e.prototype.setPosition=function(t){this.position=t},e.prototype.getPoints=function(){var t=this;return this.points.map((function(e){return t.getRotatedPoint(e)}))},e.prototype.getPolygons=function(){return this.polygons},e.prototype.getPolygons2=function(){var t=this;return this.polygons.map((function(e){var n=e.map((function(e){return t.points[e]}));return new f(n)}))},e.prototype.getScale=function(){return this.scale},e.prototype.setScale=function(t){this.scale=Math.min(Math.max(t,1),0)},e.prototype.setDirection=function(t){this.rotationDirection=l.normalize(t),this.rotationMatrix=this.calcDirectionMatrix()},e.prototype.rotate=function(t,e){this.rotation=t,e&&(this.rotationDirection=l.normalize(e)),this.rotationMatrix=this.calcDirectionMatrix()},e.prototype.calcDirectionMatrix=function(){return function(t,e){var n=e*(Math.PI/180),o=Math.cos(n),r=Math.sin(n);return[[o+Math.pow(t.x,2)*(1-o),t.x*t.y*(1-o)-t.z*r,t.x*t.z*(1-o)+t.y*r],[t.y*t.x*(1-o)+t.z*r,o+Math.pow(t.y,2)*(1-o),t.y*t.z*(1-o)-t.x*r],[t.z*t.x*(1-o)-t.y*r,t.z*t.y*(1-o)+t.x*r,o+Math.pow(t.z,2)*(1-o)]]}(this.rotationDirection,this.rotation)},e.prototype.getRotatedPoint=function(t){return{x:t.x*this.rotationMatrix[0][0]+t.y*this.rotationMatrix[0][1]+t.z*this.rotationMatrix[0][2],y:t.x*this.rotationMatrix[1][0]+t.y*this.rotationMatrix[1][1]+t.z*this.rotationMatrix[1][2],z:t.x*this.rotationMatrix[2][0]+t.y*this.rotationMatrix[2][1]+t.z*this.rotationMatrix[2][2]}},e}(d),P=function(){function t(){this.models=[]}return t.prototype.getModels=function(){return this.models},t.prototype.addModel=function(t){this.models.push(t)},t}(),w=function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function s(t){try{c(o.next(t))}catch(e){i(e)}}function a(t){try{c(o.throw(t))}catch(e){i(e)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((o=o.apply(t,e||[])).next())}))},z=function(t,e){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(c){a=[6,c],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},k=function(){function t(t){switch(this.isLooping=!1,t){case"svg":this.context=new h;break;case"canvas":this.context=new c;break;default:this.context=t}this.dataProvider=new P,this.camera=new x(this.context,this.dataProvider)}return t.prototype.getContext=function(){return this.context},t.prototype.getCamera=function(){return this.camera},t.prototype.requestPointerLock=function(){return w(this,void 0,void 0,(function(){return z(this,(function(t){return[2,this.context.requestPointerLock()]}))}))},t.prototype.update=function(){for(var t=0,e=this.dataProvider.getModels();t<e.length;t++)e[t]},t.prototype.add=function(t,e,n){n&&t.setId(n),e&&t.setPosition(e),this.dataProvider.addModel(t)},t.prototype.run=function(t){var e=t.getBoundingClientRect(),n=e.width,o=e.height;for(this.context.setWidth(n),this.context.setHeight(o);t.firstChild;)t.removeChild(t.firstChild);this.context.render(t),this.camera.run()},t.prototype.stop=function(){this.camera.destroy()},t.prototype.loop=function(){var t=this;this.isLooping&&window.requestAnimationFrame((function(){t.update(),t.loop()}))},t}(),C=(function(){function t(){this.listeners={}}t.prototype.addEventListener=function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},t.prototype.removeEventListener=function(t,e){if(this.listeners[t]){var n=this.listeners[t].indexOf(e);-1!==n&&this.listeners[t].splice(n,1)}},t.prototype.dispatch=function(t){this.listeners[t.type]&&this.listeners[t.type].forEach((function(e){return e(t)}))}}(),function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}()),M=(function(t){function e(e,n){var o=t.call(this,n)||this;return o.radius=e,o}C(e,t)}(b),function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}()),j=function(t){function e(e,n,o,r){var i=t.call(this,r)||this;return i.width=e,i.height=n,i.depth=o,i.points=[{x:-e/2,y:-n/2,z:-o/2},{x:e/2,y:-n/2,z:-o/2},{x:e/2,y:n/2,z:-o/2},{x:-e/2,y:n/2,z:-o/2},{x:-e/2,y:-n/2,z:o/2},{x:e/2,y:-n/2,z:o/2},{x:e/2,y:n/2,z:o/2},{x:-e/2,y:n/2,z:o/2}],i.polygons=[[0,1,2,3],[1,2,6,5],[4,5,6,7],[0,4,7,3],[7,3,2,6],[0,1,5,4]],i}return M(e,t),e}(b),E=n(8918),L=n(1889),D=n(9768),N=n(1134);const S=t=>{const{name:e}=t,{formState:{isSubmitting:n}}=(0,N.Gc)(),{field:o}=(0,N.bc)({name:e});return{field:{...o,...n?{disabled:!0}:{}}}};var _=n(184);const V=t=>{const{required:e,label:n,marks:r,min:i,max:s,step:a,name:c}=t,{field:{value:u=0,onChange:h}}=S({required:e,name:c}),l=(0,o.useCallback)(((t,e)=>{h(e)}),[h]);return(0,_.jsxs)(L.ZP,{container:!0,spacing:1,alignItems:"center",children:[(0,_.jsx)(L.ZP,{item:!0,container:!0,width:55,justifyContent:"flex-end",children:(0,_.jsx)(L.ZP,{item:!0,children:u.toFixed(2)})}),(0,_.jsx)(L.ZP,{item:!0,xs:!0,children:(0,_.jsx)(D.ZP,{title:n,marks:r,min:i,max:s,step:a,value:u,onChange:l})})]})};var I=n(9786);const F=t=>{const{required:e,name:n}=t,{field:{value:r=!1,disabled:i,ref:s,onChange:a,onBlur:c}}=S({required:e,name:n}),u=(0,o.useCallback)(((t,e)=>{a(e)}),[a]);return(0,_.jsx)(I.Z,{ref:s,disabled:i,checked:r,onBlur:c,onChange:u})},A=()=>(0,_.jsxs)(L.ZP,{container:!0,spacing:1,children:[(0,_.jsx)(L.ZP,{item:!0,xs:12,children:(0,_.jsx)(F,{name:"isRunning"})}),(0,_.jsx)(L.ZP,{item:!0,xs:12,children:(0,_.jsx)(V,{label:"FOV",min:0,max:200,name:"fov"})}),(0,_.jsx)(L.ZP,{item:!0,xs:12,children:(0,_.jsx)(V,{label:"Pitch",min:-90,max:90,name:"pitch"})}),(0,_.jsx)(L.ZP,{item:!0,xs:12,children:(0,_.jsx)(V,{label:"Yaw",min:-180,max:180,name:"yaw"})}),(0,_.jsxs)(L.ZP,{container:!0,item:!0,xs:6,spacing:1,children:[(0,_.jsx)(L.ZP,{item:!0,xs:12,children:(0,_.jsx)(V,{label:"Position X",marks:[{label:"-100",value:-100},{label:"0",value:0},{label:"100",value:100}],min:-100,max:100,name:"position.x"})}),(0,_.jsx)(L.ZP,{item:!0,xs:12,children:(0,_.jsx)(V,{label:"Position Y",marks:[{label:"-100",value:-100},{label:"0",value:0},{label:"100",value:100}],min:-100,max:100,name:"position.y"})}),(0,_.jsx)(L.ZP,{item:!0,xs:12,children:(0,_.jsx)(V,{label:"Position Z",marks:[{label:"-100",value:-100},{label:"0",value:0},{label:"100",value:100}],min:-100,max:100,name:"position.z"})})]}),(0,_.jsxs)(L.ZP,{container:!0,item:!0,xs:6,spacing:1,children:[(0,_.jsx)(L.ZP,{item:!0,xs:12,children:(0,_.jsx)(V,{label:"Direction X",marks:[{label:"-1",value:-1},{label:"0",value:0},{label:"1",value:1}],min:-1,max:1,step:.01,name:"direction.x"})}),(0,_.jsx)(L.ZP,{item:!0,xs:12,children:(0,_.jsx)(V,{label:"Direction Y",marks:[{label:"-1",value:-1},{label:"0",value:0},{label:"1",value:1}],min:-1,max:1,step:.01,name:"direction.y"})}),(0,_.jsx)(L.ZP,{item:!0,xs:12,children:(0,_.jsx)(V,{label:"Direction Z",marks:[{label:"-1",value:-1},{label:"0",value:0},{label:"1",value:1}],min:-1,max:1,step:.01,name:"direction.z"})})]})]}),O=(0,o.createContext)({isRunning:!1,setRunning(){},fov:100,setFov(){},pitch:0,setPitch(){},yaw:0,setYaw(){},direction:{x:1,y:0,z:0},setDirection(){},position:{x:0,y:0,z:0},setPosition(){},addEventListener(){},removeEventListener(){}}),R=t=>{const{children:e}=t,[n,s]=(0,o.useState)(!1),[a,c]=(0,o.useState)(!0),[u,h]=(0,o.useState)(100),[l,p]=(0,o.useState)(0),[f,y]=(0,o.useState)(0),[g,v]=(0,o.useState)({x:0,y:0,z:0}),[x,m]=(0,o.useState)({x:0,y:0,z:1}),b=(0,o.useRef)(new d),P=(0,o.useRef)(null);window.form=P;const w=(0,o.useCallback)((()=>{s(!1)}),[]),z=(0,o.useCallback)(((t,e)=>JSON.stringify(t)!==JSON.stringify(e)),[]),k=(0,o.useCallback)((t=>{v(t)}),[]),C=(0,o.useCallback)((t=>{m(t)}),[]),M=(0,o.useCallback)(((t,e)=>{b.current.addEventListener(t,e)}),[]),j=(0,o.useCallback)(((t,e)=>{b.current.removeEventListener(t,e)}),[]),L=(0,o.useCallback)((t=>{z(a,t.isRunning)&&(c(t.isRunning),b.current.emit("changeRunning",{data:t})),z(g,t.position)&&(v(t.position),b.current.emit("changePosition",{data:t})),z(x,t.direction)&&(m(t.direction),b.current.emit("changeDirection",{data:t})),z(u,t.fov)&&(h(t.fov),b.current.emit("changeFov",{data:t})),z(l,t.pitch)&&(p(t.pitch),b.current.emit("changePitch",{data:t})),z(f,t.yaw)&&(y(t.yaw),b.current.emit("changeYaw",{data:t}))}),[g,x,u,l,f,l]);return(0,o.useEffect)((()=>{const t=t=>{"p"===t.key&&(s((t=>!t)),t.preventDefault())};return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}}),[]),(0,_.jsxs)(O.Provider,{value:{isRunning:a,setRunning:c,fov:u,setFov:h,pitch:l,setPitch:p,yaw:f,setYaw:y,direction:x,setDirection:C,position:g,setPosition:k,addEventListener:M,removeEventListener:j},children:[(0,_.jsx)(r.ZP,{sx:{width:"50vw"},PaperProps:{sx:{width:"50vw",padding:2}},open:n,anchor:"right",onClose:w,children:(0,_.jsx)(E.l0,{ref:P,mode:"onSubmit",values:{isRunning:a,fov:u,pitch:l,yaw:f,position:g,direction:x},shouldUnregister:!0,onChange:L,children:(0,_.jsx)(i.Z,{sx:{paddingLeft:2,paddingRight:2},children:(0,_.jsx)(A,{})})})}),e]})};class Z extends b{constructor(){super(),this.points=[],this.polygons=[]}addPolygon(t){const e=[];for(let n=0;n<t.points.length;n++)e.push(this.points.length),this.points.push(t.points[n]);this.polygons.push(e)}addLine(t,e){const n=this.points.length;this.points.push(t),this.points.push(e),this.polygons.push([n,n+1])}getPolygons(){return this.polygons}}const q=()=>{const[t,e]=(0,o.useState)(!1),n=(0,o.useRef)(null),r=(0,o.useRef)(),i=(0,o.useContext)(O),s=(0,o.useCallback)((t=>{if(!r.current)return;r.current.getCamera().activateDebug(),t.preventDefault(),t.stopPropagation()}),[]),a=(0,o.useCallback)((()=>{r.current&&r.current.requestPointerLock()}),[]);return(0,o.useEffect)((()=>{if(!n.current)return;const t=r.current=new k("canvas"),e=new Z,o=new f([{x:-100,y:-10,z:-10},{x:0,y:90,z:-10},{x:100,y:-10,z:-10}]);o.setId("a");const s=new f([{x:-10,y:0,z:-90},{x:-10,y:120,z:0},{x:-10,y:0,z:90}]);s.setId("b");const a=new f([{x:-30,y:0,z:-20},{x:-20,y:50,z:0},{x:-10,y:0,z:-10}]);a.setId("c"),e.addPolygon(s),e.addPolygon(o),e.addPolygon(a),e.addPolygon(new f([{x:100,y:-30,z:100},{x:100,y:-30,z:-100},{x:-100,y:-30,z:-100},{x:-100,y:-30,z:100}])),e.setId("lines"),t.add(e),t.add(new j(100,100,100),{x:0,y:0,z:0},"cube"),t.add(new j(1,400,400),{x:-120,y:0,z:0},"fance");const c=t.getCamera();return c.setPitch(i.pitch),c.setYaw(i.yaw),c.setPosition(i.position),c.setFov(i.fov),t.run(n.current),()=>{t.stop()}}),[]),(0,o.useEffect)((()=>{const t=()=>{const t=!!document.pointerLockElement;e(t)};return document.addEventListener("pointerlockchange",t),()=>{document.removeEventListener("pointerlockchange",t)}}),[]),(0,o.useEffect)((()=>{let t,e,n,o,i,s;const a=a=>{if(!r.current)return;const c=r.current,u=c.getCamera();let h=u.getPosition();switch(a.key){case"ArrowUp":u.setPosition({...h,z:h.z+1});break;case"ArrowDown":u.setPosition({...h,z:h.z-1});break;case"ArrowLeft":u.setPosition({...h,x:h.x+1});break;case"ArrowRight":u.setPosition({...h,x:h.x-1});break;case"w":clearInterval(t),t=setInterval((()=>{const t=c.getCamera();t.setPosition({x:t.getPosition().x+t.getDirection().x,y:t.getPosition().y+t.getDirection().y,z:t.getPosition().z+t.getDirection().z})}),0),a.preventDefault(),a.stopPropagation();break;case"a":clearInterval(n),n=setInterval((()=>{const t=c.getCamera();t.setPosition({x:t.getPosition().x+t.getDirectionLeft().x,y:t.getPosition().y+t.getDirectionLeft().y,z:t.getPosition().z+t.getDirectionLeft().z})}),0),a.preventDefault(),a.stopPropagation();break;case"d":clearInterval(o),o=setInterval((()=>{const t=c.getCamera();t.setPosition({x:t.getPosition().x-t.getDirectionLeft().x,y:t.getPosition().y-t.getDirectionLeft().y,z:t.getPosition().z-t.getDirectionLeft().z})}),0),a.preventDefault(),a.stopPropagation();break;case"s":clearInterval(e),e=setInterval((()=>{const t=c.getCamera();t.setPosition({x:t.getPosition().x-t.getDirection().x,y:t.getPosition().y-t.getDirection().y,z:t.getPosition().z-t.getDirection().z})}),0),a.preventDefault(),a.stopPropagation();break;case"q":clearInterval(s),s=setInterval((()=>{const t=c.getCamera(),e=t.getPosition();t.setPosition({...e,y:e.y-1})}),0),a.preventDefault(),a.stopPropagation();break;case"e":clearInterval(i),i=setInterval((()=>{const t=c.getCamera(),e=t.getPosition();t.setPosition({...e,y:e.y+1})}),0),a.preventDefault(),a.stopPropagation()}},c=r=>{switch(r.key){case"w":clearInterval(t);break;case"a":clearInterval(n);break;case"d":clearInterval(o);break;case"s":clearInterval(e);break;case"q":clearInterval(s);break;case"e":clearInterval(i)}};return document.addEventListener("keypress",a),document.addEventListener("keyup",c),()=>{document.removeEventListener("keypress",a),document.removeEventListener("keyup",c)}}),[]),(0,o.useEffect)((()=>{if(!t)return;const e=t=>{if(!r.current)return;const e=r.current.getCamera();e.setDirectionFromAngles(e.getPitch()-.1*t.movementY,e.getYaw()+.1*t.movementX)};return document.addEventListener("mousemove",e),()=>{document.removeEventListener("mousemove",e)}}),[t]),(0,o.useEffect)((()=>{if(!r.current)return;const t=r.current.getCamera(),e=t=>{const{position:e}=t;i.setPosition(e)},n=t=>{const{direction:e,yaw:n,pitch:o}=t;i.setDirection(e),i.setPitch(o),i.setYaw(n)},o=t=>{const{fov:e}=t;i.setFov(e)};return t.addEventListener("positionChange",e),t.addEventListener("directionChange",n),t.addEventListener("fovChange",o),()=>{t.removeEventListener("positionChange",e),t.removeEventListener("directionChange",n),t.removeEventListener("fovChange",o)}}),[i]),(0,o.useEffect)((()=>{const t=t=>{if(!n.current||!r.current)return;const e=r.current;t.data.isRunning?e.run(n.current):e.stop()},e=t=>{if(!r.current)return;const e=r.current.getCamera(),{data:{position:n}}=t;e.setPosition(n)},o=t=>{if(!r.current)return;const e=r.current.getCamera(),{data:{direction:n}}=t;e.setDirection(n)},s=t=>{if(!r.current)return;const e=r.current.getCamera(),{data:{fov:n}}=t;e.setFov(n)},a=t=>{if(!r.current)return;const e=r.current.getCamera(),{data:{pitch:n}}=t;e.setPitch(n)},c=t=>{if(!r.current)return;const e=r.current.getCamera(),{data:{yaw:n}}=t;e.setYaw(n)};return i.addEventListener("changeRunning",t),i.addEventListener("changePosition",e),i.addEventListener("changeDirection",o),i.addEventListener("changeFov",s),i.addEventListener("changeYaw",c),i.addEventListener("changePitch",a),()=>{i.removeEventListener("changeRunning",t),i.removeEventListener("changePosition",e),i.removeEventListener("changeDirection",o),i.removeEventListener("changeFov",s),i.removeEventListener("changeYaw",c),i.removeEventListener("changePitch",a)}}),[i]),(0,_.jsx)("div",{ref:n,style:{width:"100%",height:"calc(100vh - 55px)"},onClick:a,onContextMenu:s})},Y=()=>(0,_.jsx)(R,{children:(0,_.jsx)(q,{})})}}]);
//# sourceMappingURL=473.915af61a.chunk.js.map