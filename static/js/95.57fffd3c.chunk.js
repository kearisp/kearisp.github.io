"use strict";(self.webpackChunkkearisp=self.webpackChunkkearisp||[]).push([[95],{6095:(t,e,n)=>{n.r(e),n.d(e,{default:()=>I});var o=n(2791),i=n(2787),r=n(697),s=n(1889),a=n(9786),c=n(9768),u=n(184);const l=t=>{const{value:e,onChange:n,...i}=t,r=(0,o.useCallback)(((t,e)=>{n&&n(e)}),[n]);return(0,u.jsxs)(s.ZP,{container:!0,spacing:2,alignItems:"center",children:[(0,u.jsx)(s.ZP,{item:!0,width:50,children:e}),(0,u.jsx)(s.ZP,{item:!0,xs:!0,children:(0,u.jsx)(c.ZP,{...i,value:e,onChange:r})})]})},h=(0,o.createContext)({isRunning:!1,setRunning(){},fov:100,setFov(){},pitch:0,setPitch(){},yaw:0,setYaw(){},direction:{x:1,y:0,z:0},setDirection(){},position:{x:0,y:0,z:0},setPosition(){}}),p=t=>{const{children:e}=t,[n,i]=(0,o.useState)(!0),[r,s]=(0,o.useState)(100),[a,c]=(0,o.useState)(0),[l,p]=(0,o.useState)(0),[y,f]=(0,o.useState)({x:0,y:0,z:0}),[x,g]=(0,o.useState)({x:0,y:0,z:1});return(0,u.jsx)(h.Provider,{value:{isRunning:n,setRunning:i,fov:r,setFov:s,pitch:a,setPitch:c,yaw:l,setYaw:p,direction:x,setDirection:g,position:y,setPosition:f},children:e})},y=()=>{const{isRunning:t,setRunning:e,fov:n,setFov:i,pitch:c,setPitch:p,yaw:y,setYaw:f,direction:x,setDirection:g,position:d,setPosition:v}=(0,o.useContext)(h),m=(0,o.useCallback)((()=>{e(!t)}),[t]),P=(0,o.useCallback)((t=>{v({...d,x:t})}),[d]),w=(0,o.useCallback)((t=>{v({...d,y:t})}),[d]),z=(0,o.useCallback)((t=>{v({...d,z:t})}),[d]),b=(0,o.useCallback)((t=>{g({...x,x:t})}),[x]),k=(0,o.useCallback)((t=>{g({...x,y:t})}),[x]),C=(0,o.useCallback)((t=>{g({...x,z:t})}),[x]);return(0,u.jsxs)(r.Z,{sx:{paddingLeft:2,paddingRight:2},children:[(0,u.jsxs)(s.ZP,{container:!0,spacing:1,children:[(0,u.jsx)(s.ZP,{item:!0,xs:12,children:(0,u.jsx)(a.Z,{checked:t,onChange:m})}),(0,u.jsx)(s.ZP,{item:!0,xs:12,children:(0,u.jsx)(l,{min:0,max:200,title:"FOV",value:n,onChange:i})})]}),(0,u.jsx)(l,{min:-90,max:90,title:"Pitch",value:c,onChange:p}),(0,u.jsx)(l,{min:-180,max:180,title:"Yaw",value:y,onChange:f}),(0,u.jsxs)(s.ZP,{container:!0,children:[(0,u.jsxs)(s.ZP,{container:!0,item:!0,xs:6,spacing:1,children:[(0,u.jsx)(s.ZP,{item:!0,xs:12,children:(0,u.jsx)(l,{min:-100,max:100,marks:[{label:"-100",value:-100},{label:"0",value:0},{label:"100",value:100}],title:"Position X",value:d.x,onChange:P})}),(0,u.jsx)(s.ZP,{item:!0,xs:12,children:(0,u.jsx)(l,{min:-100,max:100,marks:[{label:"-100",value:-100},{label:"0",value:0},{label:"100",value:100}],title:"Position Y",value:d.y,onChange:w})}),(0,u.jsx)(s.ZP,{item:!0,xs:12,children:(0,u.jsx)(l,{min:-100,max:100,marks:[{label:"-100",value:-100},{label:"0",value:0},{label:"100",value:100}],title:"Position Z",value:d.z,onChange:z})})]}),(0,u.jsxs)(s.ZP,{container:!0,item:!0,xs:6,spacing:1,children:[(0,u.jsx)(s.ZP,{item:!0,xs:12,children:(0,u.jsx)(l,{min:-1,max:1,step:.01,marks:[{label:"-1",value:-1},{label:"0",value:0},{label:"1",value:1}],title:"Direction X",value:x.x,onChange:b})}),(0,u.jsx)(s.ZP,{item:!0,xs:12,children:(0,u.jsx)(l,{min:-1,max:1,step:.01,marks:[{label:"-1",value:-1},{label:"0",value:0},{label:"1",value:1}],title:"Direction Y",value:x.y,onChange:k})}),(0,u.jsx)(s.ZP,{item:!0,xs:12,children:(0,u.jsx)(l,{min:-1,max:1,step:.01,marks:[{label:"-1",value:-1},{label:"0",value:0},{label:"1",value:1}],title:"Direction Z",value:x.z,onChange:C})})]})]})]})};var f=function(){function t(){this.width=0,this.height=0}return t.prototype.getWidth=function(){return this.width},t.prototype.getHeight=function(){return this.height},t.prototype.setWidth=function(t){this.width=t},t.prototype.setHeight=function(t){this.height=t},t}(),x=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),g=function(t){function e(){var e=t.call(this)||this;return e.canvas=document.createElement("canvas"),e.context=e.canvas.getContext("2d"),e}return x(e,t),e.prototype.setStrokeStyle=function(t){this.context.strokeStyle=t},e.prototype.setFillStyle=function(t){this.context.fillStyle=t},e.prototype.drawLine=function(t,e){this.context.lineWidth=.5,this.context.beginPath(),this.context.moveTo(t.x,t.y),this.context.lineTo(e.x,e.y),this.context.stroke(),this.context.closePath()},e.prototype.fillRect=function(t,e,n,o){this.context.fillRect(t,e,n,o)},e.prototype.fillPolygon=function(t){this.context.beginPath();var e=t[0],n=t.slice(1);this.context.moveTo(e.x,e.y);for(var o=0;o<n.length;o++)this.context.lineTo(n[o].x,n[o].y);this.context.closePath(),this.context.stroke(),this.context.fill()},e.prototype.clear=function(){this.context.clearRect(0,0,this.getWidth(),this.getHeight())},e.prototype.requestPointerLock=function(){return this.canvas.requestPointerLock()},e.prototype.render=function(t){var e=t.getBoundingClientRect(),n=e.width,o=e.height;this.canvas.width=n,this.canvas.height=o,t.append(this.canvas)},e}(f),d=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),v=function(t){function e(){var e=t.call(this)||this;return e.strokeStyle="#FFFFFF",e.fillStyle="#FFFFFF",e.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),e.svg.setAttribute("width","100%"),e.svg.setAttribute("height","100%"),e}return d(e,t),e.prototype.createSVGElement=function(t){return document.createElementNS("http://www.w3.org/2000/svg",t)},e.prototype.setStrokeStyle=function(t){this.strokeStyle=t},e.prototype.setFillStyle=function(t){this.fillStyle=t},e.prototype.drawLine=function(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg","line");n.setAttribute("x1","".concat(t.x)),n.setAttribute("y1","".concat(t.y)),n.setAttribute("x2","".concat(e.x)),n.setAttribute("y2","".concat(e.y)),n.setAttribute("stroke",this.strokeStyle),n.setAttribute("stroke-width","1"),this.svg.appendChild(n)},e.prototype.fillRect=function(t,e,n,o){var i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttribute("x","".concat(t)),i.setAttribute("y","".concat(e)),i.setAttribute("width","".concat(n)),i.setAttribute("height","".concat(o)),i.setAttribute("fill",this.fillStyle),this.svg.appendChild(i)},e.prototype.fillPolygon=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","polygon");e.setAttribute("style","fill: ".concat(this.fillStyle)),e.setAttribute("points",t.map((function(t){return"".concat(t.x,",").concat(t.y)})).join(" ")),e.setAttribute("stroke-width","0.9"),e.setAttribute("stroke","black"),this.svg.append(e)},e.prototype.clear=function(){for(;this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild)},e.prototype.requestPointerLock=function(){return this.svg.requestPointerLock()},e.prototype.render=function(t){t.append(this.svg)},e}(f),m=function(){function t(t,e,n){this.x=t,this.y=e,this.z=n}return Object.defineProperty(t.prototype,"distance",{get:function(){return t.distance(this)},enumerable:!1,configurable:!0}),t.prototype.set=function(t){this.x=t.x,this.y=t.y,this.z=t.z},t.prototype.add=function(e){return this.set(t.summary(this,e)),this},t.prototype.multiply=function(e){return this.set(t.multiply(this,e)),this},t.prototype.sub=function(e){return this.set(t.subtract(this,e)),this},t.prototype.normalize=function(){var e=t.normalize(this),n=e.x,o=e.y,i=e.z;return this.x=n,this.y=o,this.z=i,this},t.prototype.toPoint=function(){return{x:this.x,y:this.y,z:this.z}},t.fromPoint=function(e){return new t(e.x,e.y,e.z)},t.summary=function(t,e){return{x:t.x+e.x,y:t.y+e.y,z:t.z+e.z}},t.subtract=function(t,e){return{x:t.x-e.x,y:t.y-e.y,z:t.z-e.z}},t.cross=function(t,e){return{x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}},t.distance=function(t){return Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)+Math.pow(t.z,2))},t.normalize=function(t){var e=Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)+Math.pow(t.z,2));return{x:t.x/e,y:t.y/e,z:t.z/e}},t.multiply=function(t,e){return{x:t.x*e,y:t.y*e,z:t.z*e}},t.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},t}(),P=function(t,e,n){if(n||2===arguments.length)for(var o,i=0,r=e.length;i<r;i++)!o&&i in e||(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},w=function(){function t(t){this.points=t,this.distance=0}return t.prototype.setId=function(t){this.id=t},t.prototype.intersects=function(e){for(var n=0,o=P(P([],t.getNormals(this.points),!0),t.getNormals(e.points),!0);n<o.length;n++){var i=o[n],r=t.projection(this.points,i),s=t.projection(e.points,i);if(r.max<s.min||s.max<r.min)return!1;if(r.max===s.min||s.max===r.min)return!1}return!0},t.prototype.smooth=function(){return[]},t.prototype.getNormal=function(){for(var t={x:0,y:0,z:0},e=0;e<this.points.length;e++){var n=this.points[e],o=this.points[(e+1)%this.points.length],i=this.points[(e+2)%this.points.length],r=m.subtract(n,o),s=m.subtract(n,i),a=m.cross(r,s);t=m.summary(t,a)}return m.normalize({x:t.x/this.points.length,y:t.y/this.points.length,z:t.z/this.points.length})},t.prototype.getCenter=function(){for(var t={x:0,y:0,z:0},e=0;e<this.points.length;e++)t=m.summary(this.points[e],t);return{x:t.x/this.points.length,y:t.y/this.points.length,z:t.z/this.points.length}},t.intersect=function(t,e){return!1},t.getNormals=function(t){for(var e=[],n=0;n<t.length;n++){var o=t[n],i=t[(n+1)%t.length],r={x:i.x-o.x,y:i.y-o.y,z:i.z-o.z},s={x:-r.y,y:r.x,z:r.z};e.push(s)}return e},t.projection=function(t,e){for(var n=e.x*t[0].x+e.y*t[0].y,o=n,i=1;i<t.length;i++){var r=e.x*t[i].x+e.y*t[i].y;r<n?n=r:r>o&&(o=r)}return{min:n,max:o}},t}(),z=function(){return z=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},z.apply(this,arguments)},b=function(t,e,n){if(n||2===arguments.length)for(var o,i=0,r=e.length;i<r;i++)!o&&i in e||(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},k=function(){function t(t,e,n,o){void 0===n&&(n={x:0,y:0,z:0}),void 0===o&&(o={x:0,y:0,z:1}),this.context=t,this.dataProvider=e,this.position=n,this.direction=o,this.debug=!1,this.isRunning=!1,this.fov=100,this.pitch=0,this.yaw=0,this.roll=0,this.rotationMatrix=this.calcDirectionMatrix()}return t.prototype.getPosition=function(){return this.position},t.prototype.setPosition=function(t){this.position=z({},t),this.rotationMatrix=this.calcDirectionMatrix()},t.prototype.calcDirectionMatrix=function(){return function(t,e,n){void 0===n&&(n={x:0,y:1,z:0});var o=m.normalize(m.cross(n,e)),i=m.normalize(m.cross(e,o));return[[o.x,i.x,e.x,t.x],[o.y,i.y,e.y,t.y],[o.z,i.z,e.z,t.z],[0,0,0,1]]}(this.position,this.direction)},t.prototype.toCameraPoint=function(t){},t.prototype.rotatePoint=function(t){var e=this.rotationMatrix;return{x:(t.x*e[0][0]+t.y*e[1][0]+t.z*e[2][0]+e[3][0])/1,y:(t.x*e[0][1]+t.y*e[1][1]+t.z*e[2][1]+e[3][1])/1,z:(t.x*e[0][2]+t.y*e[1][2]+t.z*e[2][2]+e[3][2])/1}},t.prototype.projectPoint=function(t){var e=this.rotatePoint(t),n=e.x,o=e.y,i=e.z;if(i/3<=-this.fov)return{x:NaN,y:NaN};var r=this.fov/(this.fov+i/3);return{x:r*n,y:r*o}},t.prototype.getFov=function(){return this.fov},t.prototype.setFov=function(t){this.fov=t},t.prototype.getDirection=function(){return this.direction},t.prototype.getDirectionLeft=function(){return m.cross(this.direction,{x:0,y:1,z:0})},t.prototype.setDirection=function(t){this.direction=m.normalize(t),this.rotationMatrix=this.calcDirectionMatrix()},t.prototype.setDirectionFromAngles=function(t,e){this.pitch=Math.max(Math.min(t,90),-90),this.yaw=e;var n=this.pitch*(Math.PI/180),o=this.yaw*(Math.PI/180);this.setDirection({x:Math.cos(n)*Math.sin(o),y:Math.sin(n),z:Math.cos(n)*Math.cos(o)})},t.prototype.getYaw=function(){return this.yaw},t.prototype.getPitch=function(){return this.pitch},t.prototype.setPitch=function(t){this.setDirectionFromAngles(t,this.yaw)},t.prototype.setYaw=function(t){this.setDirectionFromAngles(this.pitch,t)},t.prototype.update=function(){var t=this;this.context.clear();for(var e=this.dataProvider.getModels().reduce((function(e,n,o){var i=n.getPosition(),r=n.getPoints();return b(b([],e,!0),n.getPolygons().map((function(e,s){var a=e.map((function(e){var n=r[e];return{x:i.x+n.x-t.position.x,y:i.y+n.y-t.position.y,z:i.z+n.z-t.position.z}})),c=new w(a);c.setId("#".concat(n.getId(),".").concat(s));var u=-100,l={x:t.direction.x*u,y:t.direction.y*u,z:t.direction.z*u};l=m.subtract(t.position,l);var h=c.points.reduce((function(t,e,n){var o=e,i=c.points[c.points.length===n+1?0:n+1],r=m.subtract(i,o),s=m.subtract(o,l),a=m.cross(r,s);return t+m.distance(a)/m.distance(r)}),0);return c.sum=h,c.distance=h/Math.max(c.points.length,1),c.color="hsl(".concat(100*o,", 100%, 50%)"),c})),!0)}),[]).sort((function(t,e){return e.distance-t.distance})),n=0,o=e;n<o.length;n++){var i=o[n],r=i.points.map((function(e){var n=t.projectPoint(e),o=n.x,i=n.y;return{x:t.context.getWidth()/2+o,y:t.context.getHeight()/2-i}})).filter((function(t){return!isNaN(t.x)&&!isNaN(t.y)}));r.length>0&&(this.context.setStrokeStyle("#000000"),this.context.setFillStyle(i.color||"#CC0000"),this.context.fillPolygon(r))}return this.debug&&(this.debug=!1,e.forEach((function(t){console.info(t.id,t.distance,t)}))),e},t.prototype.run=function(){this.isRunning=!0,this.loop()},t.prototype.destroy=function(){this.isRunning=!1},t.prototype.activateDebug=function(){this.debug=!0},t.prototype.loop=function(){var t=this;this.isRunning&&requestAnimationFrame((function(){t.update(),t.loop()}))},t}(),C=function(){function t(t){this.scale=1,this.rotation=0,this.rotationDirection={x:0,y:1,z:0},this.points=[],this.polygons=[],this.position=t||{x:0,y:0,z:0},this.rotationMatrix=this.calcDirectionMatrix()}return t.prototype.getId=function(){return this.id},t.prototype.setId=function(t){this.id=t},t.prototype.getPosition=function(){return this.position},t.prototype.setPosition=function(t){this.position=t},t.prototype.getPoints=function(){var t=this;return this.points.map((function(e){return t.getRotatedPoint(e)}))},t.prototype.getPolygons=function(){return this.polygons},t.prototype.getScale=function(){return this.scale},t.prototype.setScale=function(t){this.scale=Math.min(Math.max(t,1),0)},t.prototype.setDirection=function(t){this.rotationDirection=m.normalize(t),this.rotationMatrix=this.calcDirectionMatrix()},t.prototype.rotate=function(t,e){this.rotation=t,e&&(this.rotationDirection=m.normalize(e)),this.rotationMatrix=this.calcDirectionMatrix()},t.prototype.calcDirectionMatrix=function(){return function(t,e){var n=e*(Math.PI/180),o=Math.cos(n),i=Math.sin(n);return[[o+Math.pow(t.x,2)*(1-o),t.x*t.y*(1-o)-t.z*i,t.x*t.z*(1-o)+t.y*i],[t.y*t.x*(1-o)+t.z*i,o+Math.pow(t.y,2)*(1-o),t.y*t.z*(1-o)-t.x*i],[t.z*t.x*(1-o)-t.y*i,t.z*t.y*(1-o)+t.x*i,o+Math.pow(t.z,2)*(1-o)]]}(this.rotationDirection,this.rotation)},t.prototype.getRotatedPoint=function(t){return{x:t.x*this.rotationMatrix[0][0]+t.y*this.rotationMatrix[0][1]+t.z*this.rotationMatrix[0][2],y:t.x*this.rotationMatrix[1][0]+t.y*this.rotationMatrix[1][1]+t.z*this.rotationMatrix[1][2],z:t.x*this.rotationMatrix[2][0]+t.y*this.rotationMatrix[2][1]+t.z*this.rotationMatrix[2][2]}},t}(),M=function(){function t(){this.models=[]}return t.prototype.getModels=function(){return this.models},t.prototype.addModel=function(t){this.models.push(t)},t}(),j=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function s(t){try{c(o.next(t))}catch(e){r(e)}}function a(t){try{c(o.throw(t))}catch(e){r(e)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((o=o.apply(t,e||[])).next())}))},D=function(t,e){var n,o,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(i=2&a[0]?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(c){a=[6,c],o=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},S=function(){function t(t){switch(this.isLooping=!1,t){case"svg":this.context=new v;break;case"canvas":this.context=new g;break;default:this.context=t}this.dataProvider=new M,this.camera=new k(this.context,this.dataProvider)}return t.prototype.getContext=function(){return this.context},t.prototype.getCamera=function(){return this.camera},t.prototype.requestPointerLock=function(){return j(this,void 0,void 0,(function(){return D(this,(function(t){return[2,this.context.requestPointerLock()]}))}))},t.prototype.update=function(){for(var t=0,e=this.dataProvider.getModels();t<e.length;t++)e[t]},t.prototype.add=function(t,e,n){n&&t.setId(n),e&&t.setPosition(e),this.dataProvider.addModel(t)},t.prototype.run=function(t){var e=t.getBoundingClientRect(),n=e.width,o=e.height;for(this.context.setWidth(n),this.context.setHeight(o);t.firstChild;)t.removeChild(t.firstChild);this.context.render(t),this.camera.run()},t.prototype.stop=function(){this.camera.destroy()},t.prototype.loop=function(){var t=this;this.isLooping&&window.requestAnimationFrame((function(){t.update(),t.loop()}))},t}(),A=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),L=(function(t){function e(e,n){var o=t.call(this,n)||this;return o.radius=e,o}A(e,t)}(C),function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}()),E=function(t){function e(e,n,o,i){var r=t.call(this,i)||this;return r.width=e,r.height=n,r.depth=o,r.points=[{x:-e/2,y:-n/2,z:-o/2},{x:e/2,y:-n/2,z:-o/2},{x:e/2,y:n/2,z:-o/2},{x:-e/2,y:n/2,z:-o/2},{x:-e/2,y:-n/2,z:o/2},{x:e/2,y:-n/2,z:o/2},{x:e/2,y:n/2,z:o/2},{x:-e/2,y:n/2,z:o/2}],r.polygons=[[0,1,2,3],[1,2,6,5],[4,5,6,7],[0,4,7,3],[7,3,2,6],[0,1,5,4]],r}return L(e,t),e}(C);class _ extends C{constructor(){super(),this.points=[],this.polygons=[]}addPolygon(t){const e=[];for(let n=0;n<t.points.length;n++)e.push(this.points.length),this.points.push(t.points[n]);this.polygons.push(e)}addLine(t,e){const n=this.points.length;this.points.push(t),this.points.push(e),this.polygons.push([n,n+1])}}const F=()=>{const[t,e]=(0,o.useState)(!1),n=(0,o.useRef)(null),i=(0,o.useRef)(),{isRunning:r,fov:s,pitch:a,yaw:c,direction:l}=(0,o.useContext)(h),p=(0,o.useCallback)((t=>{if(!i.current)return;i.current.getCamera().activateDebug(),t.preventDefault(),t.stopPropagation()}),[]),y=(0,o.useCallback)((()=>{i.current&&i.current.requestPointerLock()}),[]);return(0,o.useEffect)((()=>{if(!n.current)return;const t=i.current=new S("canvas"),e=new _,o=new w([{x:-100,y:0,z:-10},{x:0,y:120,z:-10},{x:100,y:0,z:-10}]),r=new w([{x:-10,y:0,z:-90},{x:-10,y:90,z:0},{x:-10,y:0,z:90}]);e.addPolygon(o),e.addPolygon(r);const s=o.getCenter(),a=m.fromPoint(o.getNormal()).multiply(100).add(s);e.addLine(s,a);const c=r.getCenter(),u=m.fromPoint(r.getNormal()).multiply(100).add(c);e.addLine(c,u),t.add(e);for(let n=-6;n<=6;n++)for(let e=-6;e<=6;e++)t.add(new E(200,1,200),{x:200*n,y:-2e3,z:200*e}),t.add(new E(200,1,200),{x:200*n,y:2e3,z:200*e});return t.run(n.current),()=>{t.stop()}}),[]),(0,o.useEffect)((()=>{const t=()=>{const t=!!document.pointerLockElement;e(t)};return document.addEventListener("pointerlockchange",t),()=>{document.removeEventListener("pointerlockchange",t)}}),[]),(0,o.useEffect)((()=>{let t,e,n,o,r,s;const a=a=>{if(!i.current)return;const c=i.current,u=c.getCamera();let l=u.getPosition();switch(a.key){case"ArrowUp":u.setPosition({...l,z:l.z+1});break;case"ArrowDown":u.setPosition({...l,z:l.z-1});break;case"ArrowLeft":u.setPosition({...l,x:l.x+1});break;case"ArrowRight":u.setPosition({...l,x:l.x-1});break;case"w":clearInterval(t),t=setInterval((()=>{const t=c.getCamera();t.setPosition({x:t.getPosition().x+t.getDirection().x,y:t.getPosition().y+t.getDirection().y,z:t.getPosition().z+t.getDirection().z})}),0),a.preventDefault(),a.stopPropagation();break;case"a":clearInterval(n),n=setInterval((()=>{const t=c.getCamera();t.setPosition({x:t.getPosition().x+t.getDirectionLeft().x,y:t.getPosition().y+t.getDirectionLeft().y,z:t.getPosition().z+t.getDirectionLeft().z})}),0),a.preventDefault(),a.stopPropagation();break;case"d":clearInterval(o),o=setInterval((()=>{const t=c.getCamera();t.setPosition({x:t.getPosition().x-t.getDirectionLeft().x,y:t.getPosition().y-t.getDirectionLeft().y,z:t.getPosition().z-t.getDirectionLeft().z})}),0),a.preventDefault(),a.stopPropagation();break;case"s":clearInterval(e),e=setInterval((()=>{const t=c.getCamera();t.setPosition({x:t.getPosition().x-t.getDirection().x,y:t.getPosition().y-t.getDirection().y,z:t.getPosition().z-t.getDirection().z})}),0),a.preventDefault(),a.stopPropagation();break;case"q":clearInterval(s),s=setInterval((()=>{const t=c.getCamera(),e=t.getPosition();t.setPosition({...e,y:e.y-1})}),0),a.preventDefault(),a.stopPropagation();break;case"e":clearInterval(r),r=setInterval((()=>{const t=c.getCamera(),e=t.getPosition();t.setPosition({...e,y:e.y+1})}),0),a.preventDefault(),a.stopPropagation()}},c=i=>{switch(i.key){case"w":clearInterval(t);break;case"a":clearInterval(n);break;case"d":clearInterval(o);break;case"s":clearInterval(e);break;case"q":clearInterval(s);break;case"e":clearInterval(r)}};return document.addEventListener("keypress",a),document.addEventListener("keyup",c),()=>{document.removeEventListener("keypress",a),document.removeEventListener("keyup",c)}}),[]),(0,o.useEffect)((()=>{if(!t)return;const e=t=>{if(!i.current)return;const e=i.current.getCamera();e.setDirectionFromAngles(e.getPitch()-.1*t.movementY,e.getYaw()+.1*t.movementX)};return document.addEventListener("mousemove",e),()=>{document.removeEventListener("mousemove",e)}}),[t]),(0,o.useEffect)((()=>{if(!n.current||!i.current)return;const t=i.current;r?t.run(n.current):t.stop()}),[r]),(0,o.useEffect)((()=>{if(!i.current)return;i.current.getCamera().setFov(s)}),[s]),(0,o.useEffect)((()=>{if(!i.current)return;i.current.getCamera().setPitch(a)}),[a]),(0,o.useEffect)((()=>{if(!i.current)return;i.current.getCamera().setYaw(c)}),[c]),(0,u.jsx)("div",{ref:n,style:{width:"100%",height:"calc(100vh - 55px)"},onClick:y,onContextMenu:p})},I=()=>{const[t,e]=(0,o.useState)(!1),n=(0,o.useCallback)((()=>{e(!1)}),[]);return(0,o.useEffect)((()=>{const t=t=>{"p"===t.key&&(e((t=>!t)),t.preventDefault())};return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}}),[]),(0,u.jsxs)(p,{children:[(0,u.jsx)(i.ZP,{sx:{width:"40vw"},PaperProps:{sx:{width:"40vw",padding:2}},open:t,anchor:"left",onClose:n,children:(0,u.jsx)(y,{})}),(0,u.jsx)(F,{})]})}}}]);
//# sourceMappingURL=95.57fffd3c.chunk.js.map